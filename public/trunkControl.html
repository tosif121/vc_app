<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />

  <title>trunk Data</title>
  <meta content="" name="description" />
  <meta content="" name="keywords" />

  <!-- Favicons -->
  <link href="./img/favicon.png" rel="icon" />

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect" />
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet" />

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet" />
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet" />
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet" />

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<body>
  <!-- ======= Header ======= -->
  <header style="height: 70px;" id="header" class="header fixed-top d-flex align-items-center">
    <i class="bi bi-list toggle-sidebar-btn"></i>

    <div class="d-flex align-items-center justify-content-center" style="padding: 2vw">
      <a href="trunkControl.html" class="logo d-flex align-items-center">
        <img src="./img/logo.png" alt="iotcom" />
      </a>
    </div>
    <!-- End Logo -->

    <div class="search-bar" style="display: none">
      <form class="search-form d-flex align-items-center" method="POST" action="#">
        <input type="text" name="query" placeholder="Search" title="Enter search keyword" />
        <button type="submit" title="Search">
          <i class="bi bi-search"></i>
        </button>
      </form>
    </div>
    <!-- End Search Bar -->

    <nav   class="header-nav ms-auto">
      <ul class="d-flex align-items-center">
        <li class="nav-item d-block d-lg-none">
          <a class="nav-link nav-icon search-bar-toggle" href="#" style="display: none">
            <i class="bi bi-search"></i>
          </a>
        </li>
        <!-- End Search Icon-->

        <li class="nav-item dropdown pe-3">
          <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
            <img src="img/shiv.jpg" alt="Profile" class="rounded-circle" />
            <span class="d-none d-md-block dropdown-toggle ps-2" id="displayUsername"></span>
          </a><!-- End Profile Iamge Icon -->

          <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
            <li class="dropdown-header">
              <h6 id="displayUsername1">Shiv Shekhawat</h6>
              <span id="displayorg">Web Designer</span>
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                <i class="bi bi-person"></i>
                <span>My Profile</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                <i class="bi bi-gear"></i>
                <span>Account Settings</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="pages-faq.html">
                <i class="bi bi-question-circle"></i>
                <span>Need Help?</span>
              </a>
            </li>
            <li>
              <hr class="dropdown-divider" />
            </li>

            <li>
              <a class="dropdown-item d-flex align-items-center" href="#" onclick="signOut()">
                <i class="bi bi-box-arrow-right"></i>
                <span>Sign Out</span>
              </a>
            </li>
          </ul>
          <!-- End Profile Dropdown Items -->
        </li>
        <!-- End Profile Nav -->
      </ul>
    </nav>
    <!-- End Icons Navigation -->
  </header>
  <!-- End Header -->


  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">
    <ul class="sidebar-nav" id="sidebar-nav">
      <li class="nav-item">
        <a class="nav-link" href="trunkControl.html">
          <i class="bi bi-grid"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <!-- End Dashboard Nav -->
      <li class="nav-item">
        <a class="nav-link" href="didControl.html">
          <i class="bi bi-grid"></i>
          <span>DID Data</span>
        </a>
      </li>

    </ul>
  </aside>
  <!-- End Sidebar-->

  <main style="margin-top: 80px;" id="main">
    <style>
      body {
        font-family: sans-serif;
      }

      a {
        text-decoration: none;
      }

      h2 {
        color: #000000;
        text-align: center;
      }

      .btn-success {
        background-color: #28a745;
        border-color: #28a745;
      }

      .btn-success:hover {
        background-color: #218838;
        border-color: #1e7e34;
        transform: scale(1.1);
      }

      .modal-content {
        border-radius: 10px;
      }

      .modal-header {
        background-color: #225d97;
        color: #ffffff;
        border-bottom: none;
      }

      .modal-body input,
      .modal-body select {
        margin-bottom: 20px;
        border-radius: 5px;
        border: 1px solid #ced4da;
        height: 40px;
        width: calc(100% - 20px);
        padding: 0 10px;
      }

      .modal-body input:focus,
      .modal-body select:focus {
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.6);
        border-color: #80bdff;
      }

      .modal-footer {
        border-top: none;
      }

      .table th,
      .table td {
        text-align: center;
      }

      .table thead th {
        background-color: #225d97;
        color: #ffffff;
        border-color: #225d97;
      }

      .table tbody tr:hover {
        background-color: #f2f2f2;
      }

      .edit-btn,
      .delete-btn {
        border-radius: 5px;
        margin-right: 10px;
      }

      .btn-sm:hover {
        transform: scale(1.1);
      }

      .notification {
        display: none;
        position: fixed;
        background-color: #225d97;
        font-weight: bold;
        color: white;
        padding: 12px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        top: 10%;
        right: 5%;
        max-width: 300px;
        width: 100%;
        text-align: center;
        z-index: 999;
        transition: top 0.3s ease-in-out;
      }

      .show-notification {
        display: block;
        animation: fadeIn 0.5s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Responsive CSS */
      @media screen and (max-width: 768px) {
        .notification {
          font-size: 16px;
          padding: 15px;
        }
      }

      @media screen and (max-width: 480px) {
        .notification {
          font-size: 14px;
          padding: 12px;
        }
      }
    </style>
    <div   class="container mt-5">
      <h2>Trunk Data</h2>
      <!-- Button to trigger modal -->
      <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#myModal">
        Add Api
      </button>
      <table class="table table-bordered" id="dataTable">
        <thead>
          <tr>
            <!-- <th>Campaign ID</th> -->
            <th>Trunk</th>
            <th>adminuser</th>
            <th>Clinunmber</th>
            <th>Edit</th>
            <th>Delete</th>
          </tr>
        </thead>
        <tbody id="fileTable">
          <!-- Table rows will be dynamically added here -->
        </tbody>
      </table>

      <div class="notification" id="successMessage">
        <div class="notification-content">
          <p>trunk data Added Successfully!</p>
        </div>
      </div>


      <div class="notification" id="EditMessage">
        <div class="notification-content">
          <p>trunk data Edited Successfully!</p>
        </div>
      </div>


      <div class="notification" id="DeleteMessage">
        <div class="notification-content">
          <p>trunk data Deleted Successfully!</p>
        </div>
      </div>

    </div>

    <!-- Add campaign Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">New admintrunk</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="addForm">
                <div class="form-group">
                    <label for="adminuser">adminuser:</label>
                    <input type="text" class="form-control" id="adminuser" name="adminuser"  required />
                </div>
                <div class="form-group">
                    <label for="number">Clinunmber:</label>
                    <input type="text" class="form-control" id="number" name="number"  required />
                </div> 
                <div class="form-group">
                    <label for="trunk">trunk:</label>
                    <input type="text" class="form-control" id="trunk" name="trunk"  required />
                </div> 

              <button type="button" class="btn btn-success" id="addRowBtn">
                Submit
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!--edit Api Model-->
    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel1">Edit trunks</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editForm">
                <div class="form-group">
                    <label for="adminuser1">adminuser:</label>
                    <input type="text" class="form-control" id="adminuser1" name="adminuser1"  disabled />
                </div>
                <div class="form-group">
                    <label for="number">Clinunmber:</label>
                    <input type="text" class="form-control" id="number1" name="number1"  required />
                </div> 
                <div class="form-group">
                    <label for="trunk">trunk:</label>
                    <input type="text" class="form-control" id="trunk1" name="trunk1"  required />
                </div> 
                    

               <button type="button" class="btn btn-success" id="addRowBtn1">
                Submit
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      
      document
        .getElementById("addRowBtn")
        .addEventListener("click", async function () {
          // Get input values (including the new call transfer option)
          const adminuser = document.getElementById("adminuser").value;
          const trunk = document.getElementById("trunk").value;
          const number =document.getElementById("number").value;
          

          // Check if all fields are filled
          if (
            adminuser &&
            trunk &&
            number
          ) {
           
          
          
            const Data = {
            adminuser : adminuser,
            trunk : trunk ,
            number : number 
            };
            console.log(Data);

            try {
              const response = await fetch("/createnewCli", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  'Authorization': `Bearer ${localStorage.getItem('jwtToken')}`
                },
                body: JSON.stringify(Data),
              });

              if (response) {
                if (response.status === 401) {
                  // Unauthorized response handling: redirect to index page or handle as needed
                  window.location.href = '/superLogin.html'; // Replace with your index page URL
                }
                else {
                  const result = await response.json();
                  console.log(result);
                  if (result) {
                    if (result.message === "duplicate admin user") {
                      alert(result.message);
                      Object.keys(ApiData).forEach(
                        (key) => delete ApiData[key]
                      );
                    }
                    else if (
                      result.message ===
                      "database error in saving data to database"
                    ) {
                      alert(result.message);
                      Object.keys(ApiData).forEach(
                        (key) => delete ApiData[key]
                      );
                    }
                    else if (result.message === "Cli Added successfully") {
                      $("#myModal").modal("hide");
                      var notification =
                        document.getElementById("successMessage");
                      notification.classList.add("show-notification");

                      setTimeout(function () {
                        notification.classList.remove("show-notification");
                        createdom();
                      }, 1000); // Hide the notification after 5 seconds

                    }
                  }
                }
              } else {
                alert(
                  "failed to add Cli due to server error,try after some time"
                );
              }
            } catch (err) {
              console.error("Error:", err);
              alert("Error in app coding data in creating .");
            }
          
          } else {
            // If not all fields are filled, display an error message
            alert(
              "Please fill out all fields before adding the Cli."
            );
          }
        });

      document.addEventListener("DOMContentLoaded", function () {
        createdom();
      });

      async function createdom() {

        fetch("/cliDetails", {
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('jwtToken')}`
          },
        })
          .then((response) => {
            if (response.status === 401) {
              // Unauthorized response handling: redirect to index page or handle as needed
              window.location.href = "/superLogin.html"; // Replace with your index page URL
            } else if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            else {
              return response.json();
            }
          })
          .then((data) => {
            ApiDetails = data.result;
            console.log(ApiDetails);
            refreshTable(ApiDetails);
          })
          .catch((error) => {
            console.error("Error fetching campaign details:", error);
          });
      }

      function refreshTable(file) {
        const audioFiles = file || [];
        console.log(audioFiles);
        var table = document.getElementById("fileTable");
        table.innerHTML = "";

        audioFiles.forEach(function (file, index) {
          const newRow = table.insertRow(table.rows.length);
          const cell1 = newRow.insertCell(0);
          const cell2 = newRow.insertCell(1);
          const cell3 = newRow.insertCell(2);
          const cell4 = newRow.insertCell(3);
          const cell5 = newRow.insertCell(4);
         
          


          // cell1.textContent = file.campaignID || file.campaignid;
          cell1.textContent = file.trunk;
          cell2.textContent = file.adminuser;
          cell3.textContent = file.number;
          
          var editButton = document.createElement("button");
          editButton.className = "btn btn-success ";
          editButton.innerHTML = '<i class="bi bi-pencil-square"></i>';
          cell4.appendChild(editButton);

          var deleteButton = document.createElement("button");
          deleteButton.className = "btn btn-danger";
          deleteButton.innerHTML = "<i class='bi bi-trash'></i>";
          cell5.appendChild(deleteButton);

          editButton.addEventListener("click", () => editcallmenu(file, index));
          deleteButton.addEventListener("click", () =>
            deletecallmenu(file, index)
          );
        });
      }

      // Function to delete callmenu from data
      function deletecallmenu(file, index) {
        const confirmation = window.confirm(
          `Do you really want to delete Current cli of ${file.adminuser} ?`
        );
        if (confirmation) {
          const campaignID = file.adminuser; // getting callmenu id
          const url = `/CliData/${campaignID}`;

          // Make a DELETE request to the server
          fetch(url, {
            method: "DELETE",
            headers: {
              "Authorization": `Bearer ${localStorage.getItem('jwtToken')}`
            },
          })
            .then((response) => {
              if (response.status === 401) {
                // Unauthorized response handling: redirect to index page or handle as needed
                window.location.href = "/superLogin.html"; // Replace with your index page URL
              } else if (!response.ok) {
                throw new Error("Failed to delete ");
              }
              else {
                return response.json();
              }
            })
            .then((data) => {
              console.log(data.message); // You can do something with the response from the server if needed

              var notification =
                document.getElementById("DeleteMessage");
              notification.classList.add("show-notification");

              setTimeout(function () {
                notification.classList.remove("show-notification");
                createdom();
              }, 1000);
            })
            .catch((error) => {
              console.error("Error deleting :", error);
            });
        }
      }

      function editcallmenu(file, index) {
        $("#editModal").modal("show");
        let adminuser1 = (document.getElementById("adminuser1").value = file.adminuser);
        let trunk1= (document.getElementById("trunk1").value = file.trunk);
        let number1 = (document.getElementById("number1").value = file.number);
        function handleAddRowBtnClick() {
          const adminuser1 = document.getElementById("adminuser1").value;
          const trunk1 = document.getElementById("trunk1").value;
          const number1 = document.getElementById("number1").value;
         
          
         if(adminuser1 && trunk1 && number1){
          // first validate
         
          const newData = {
           adminuser : adminuser1,
           trunk : trunk1 ,
           number : number1
          };
          console.log(newData);
          const url = `/CliData/${adminuser1}`;

          // Make an edit request to the server
          fetch(url, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${localStorage.getItem("jwtToken")}`,
            },
            body: JSON.stringify(newData),
          })
            .then((response) => {
              if (response.status === 401) {
                // Unauthorized response handling: redirect to index page or handle as needed
                window.location.href = "/superLogin.html"; // Replace with your index page URL
              } else if (!response.ok) {
                throw new Error("Failed to update Cli");
              } else {
                return response.json();
              }
            })
            .then((data) => {
              console.log(data.message); // You can do something with the response from the server if needed
              $("#editModal").modal("hide");

              var notification = document.getElementById("EditMessage");
              notification.classList.add("show-notification");

              setTimeout(function () {
                notification.classList.remove("show-notification");
                createdom();
              }, 1000);

            })
            .catch((error) => {
              console.error("Error Updating:", error);
            });
          
        }else{
            alert("Enter All Fields");
        }
        }

        // Add event listener to the "Add Row" button
        document.getElementById("addRowBtn1").addEventListener("click", handleAddRowBtnClick);

        // Remove event listener when the modal is hidden
        $("#editModal").on("hidden.bs.modal", function () {
          document.getElementById("addRowBtn1").removeEventListener("click", handleAddRowBtnClick);
        });
      }

     





      function signOut() {
        // Clear localStorage (optional)
       // localStorage.removeItem('admininfo');
        localStorage.removeItem('jwtToken');
       // localStorage.removeItem('didData');

        // Redirect to the desired location
        window.location.href = '/superLogin.html';
      }
    </script>
  </main>
  <!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>iotcom</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
      Designed by <a href="https://www.iotcom.io/">Iotcom</a>
    </div>
  </footer>
  <!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>
  <!-- Vendor JS Files -->
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>
</body>

</html>