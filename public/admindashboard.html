<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Admin Dashboard</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="./img/favicon.png" rel="icon" />

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />

    <!-- <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet"> -->

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />
  </head>

  <body>
    <section class="d-flex min-vh-100 flex-column">
      <!-- ======= Header ======= -->
      <header id="header" class="header sticky-top d-flex align-items-center">
        <div class="d-flex align-items-center justify-content-center">
          <a href="admindashboard.html" class="logo d-flex align-items-center">
            <img src="./img/logo.png" alt="iotcom" />
          </a>
        </div>
        <div class="ms-auto d-flex align-items-end">
          <div id="sidebar" class="sidebar me-5">
            <ul class="sidebar-nav d-flex gap-4" id="sidebar-nav">
              <li class="nav-item">
                <a class="nav-link active" href="admindashboard.html">
                  <!-- <i class="bi bi-grid"></i> -->
                  <span>Dashboard</span>
                </a>
              </li>
              <!-- End Dashboard Nav -->

              <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#icons-nav" data-bs-toggle="collapse" href="#">
                  <!-- <i class="bi bi-gem"></i> -->
                  <span>Users</span><i class="bi bi-chevron-down ms-2"></i>
                </a>
                <ul id="icons-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                  <li>
                    <a href="adduser.html"> <i class="bi bi-chevron-right"></i><span>Add New Users</span> </a>
                  </li>
                  <li>
                    <a href="userlist.html"> <i class="bi bi-chevron-right"></i><span>User List</span> </a>
                  </li>
                  <li>
                    <a href="AgentLoginHours.html">
                      <i class="bi bi-chevron-right"></i><span>Agent Login Hours</span>
                    </a>
                  </li>

                  <li>
                    <a href="Forcelogout.html"> <i class="bi bi-chevron-right"></i><span>Force Logout</span> </a>
                  </li>
                </ul>
              </li>

              <!-- Broadcast Section -->
              <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#Broadcast-nav" data-bs-toggle="collapse" href="#">
                  <!-- <i class="bi bi-broadcast"></i> -->
                  <span>Broadcast</span><i class="bi bi-chevron-down ms-2"></i>
                </a>
                <ul id="Broadcast-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                  <li>
                    <a href="broadcast.html"> <i class="bi bi-chevron-right"></i><span>Add Broadcast</span> </a>
                  </li>
                  <li>
                    <a href="Broadcastform.html"> <i class="bi bi-chevron-right"></i><span>Upload Broadcast</span> </a>
                  </li>
                  <li>
                    <a href="broadCastReport.html">
                      <i class="bi bi-chevron-right"></i><span>Broadcast Report</span>
                    </a>
                  </li>
                  <li>
                    <a href="broadCastSummary.html">
                      <i class="bi bi-chevron-right"></i><span>Broadcast Summary</span>
                    </a>
                  </li>
                  <!-- Add more items as needed -->
                </ul>
              </li>

              <!-- campagian Section -->
              <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#Campaign-nav" data-bs-toggle="collapse" href="#">
                  <!-- <i class="bi bi-layout-text-window-reverse"></i> -->
                  <span>Campaign</span><i class="bi bi-chevron-down ms-2"></i>
                </a>
                <ul id="Campaign-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                  <li>
                    <a href="newcampaign.html"> <i class="bi bi-chevron-right"></i><span>Add Campaign</span> </a>
                  </li>

                  <li>
                    <a href="form.html"> <i class="bi bi-chevron-right"></i><span>Upload Campaign</span> </a>
                  </li>
                  <!-- Add more items as needed -->
                </ul>
              </li>
              <!-- End Blank Page Nav -->

              <li class="nav-item">
                <a class="nav-link collapsed" href="CallMenu.html">
                  <!-- <i class="bi bi-telephone-plus"></i> -->
                  <span>Menu</span>
                </a>
              </li>
              <!-- End Blank Page Nav -->

              <li class="nav-item">
                <a class="nav-link collapsed" href="AudioStore.html">
                  <!-- <i class="bi bi-file-earmark-music"></i> -->
                  <span>Audio Store</span>
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link collapsed" href="DID.html">
                  <!-- <i class="bi bi-card-list"></i> -->
                  <span>DID</span>
                </a>
              </li>

              <li class="nav-item">
                <a class="nav-link collapsed" data-bs-target="#Data-nav" data-bs-toggle="collapse" href="#">
                  <span>Call Data</span> <i class="bi bi-chevron-down ms-2"></i>
                </a>
                <ul id="Data-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
                  <li>
                    <a href="IncomingCallData.html">
                      <i class="bi bi-chevron-right"></i><span>Incoming Call Data</span>
                    </a>
                  </li>

                  <li>
                    <a href="OutgoinfCallData.html">
                      <i class="bi bi-chevron-right"></i><span>Outgoing Call Data</span>
                    </a>
                  </li>
                  <li>
                    <a href="incomingDrop.html"> <i class="bi bi-chevron-right"></i><span>Drop CallData</span> </a>
                  </li>
                  <!-- Add more items as needed -->
                </ul>
              </li>
            </ul>
          </div>

          <!-- End Logo -->

          <div class="search-bar" style="display: none">
            <form class="search-form d-flex align-items-center" method="POST" action="#">
              <input type="text" name="query" placeholder="Search" title="Enter search keyword" />
              <button type="submit" title="Search">
                <i class="bi bi-search"></i>
              </button>
            </form>
          </div>
          <!-- End Search Bar -->

          <nav class="header-nav ms-auto">
            <ul class="d-flex align-items-center">
              <li class="nav-item d-block d-lg-none">
                <a class="nav-link nav-icon search-bar-toggle" href="#" style="display: none">
                  <i class="bi bi-search"></i>
                </a>
              </li>
              <!-- End Search Icon-->

              <li class="nav-item dropdown pe-3">
                <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
                  <img src="img/shiv.jpg" alt="Profile" class="rounded-circle" />
                  <span class="d-none d-md-block dropdown-toggle ps-2 text-capitalize" id="displayUsername"></span> </a
                ><!-- End Profile Iamge Icon -->

                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                  <li class="dropdown-header text-capitalize">
                    <h6 id="displayUsername1">Shiv Shekhawat</h6>
                    <span id="displayorg">Web Designer</span>
                  </li>
                  <li>
                    <hr class="dropdown-divider" />
                  </li>

                  <li>
                    <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                      <i class="bi bi-person"></i>
                      <span>My Profile</span>
                    </a>
                  </li>
                  <li>
                    <hr class="dropdown-divider" />
                  </li>

                  <li>
                    <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                      <i class="bi bi-gear"></i>
                      <span>Account Settings</span>
                    </a>
                  </li>
                  <li>
                    <hr class="dropdown-divider" />
                  </li>

                  <li>
                    <a class="dropdown-item d-flex align-items-center" href="pages-faq.html">
                      <i class="bi bi-question-circle"></i>
                      <span>Need Help?</span>
                    </a>
                  </li>
                  <li>
                    <hr class="dropdown-divider" />
                  </li>

                  <li>
                    <a class="dropdown-item d-flex align-items-center" href="#" onclick="signOut()">
                      <i class="bi bi-box-arrow-right"></i>
                      <span>Sign Out</span>
                    </a>
                  </li>
                </ul>
                <!-- End Profile Dropdown Items -->
              </li>
              <!-- End Profile Nav -->
            </ul>
          </nav>
        </div>
        <!-- End Icons Navigation -->
      </header>
      <!-- End Header -->

      <!-- ======= Sidebar ======= -->
      <!-- End Sidebar-->

      <main id="main" class="main mt-3 flex-grow-1">
        <audio id="remoteaudio" autoplay style="display: none"></audio>
        <div class="container-fluid text-center">
          <div class="row align-items-end">
            <div class="col">
              <div class="box p-3 m-0 bg-white shadow-sm rounded-3">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="">
                    <p class="fw-bold fs-3" id="agentlogedin">0</p>
                    <h5 class="">Agents Logged In</h5>
                  </div>
                  <div class="">
                    <i class="fs-1 active bi bi-people-fill"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="box p-3 m-0 bg-white shadow-sm rounded-3">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="">
                    <p class="fw-bold fs-3" id="agentincall">0</p>
                    <h5 class="">Agents In Calls</h5>
                  </div>
                  <div class="">
                    <i class="fs-1 active bi bi-person-check-fill"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="box p-3 m-0 bg-white shadow-sm rounded-3">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="">
                    <p class="fw-bold fs-3" id="breakagent">0</p>
                    <h5 class="">Agent on Break</h5>
                  </div>
                  <div class="">
                    <i class="fs-1 active bi bi-telephone-inbound-fill"></i>
                  </div>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="box p-3 m-0 bg-white shadow-sm rounded-3">
                <div class="d-flex align-items-center justify-content-between">
                  <div class="">
                    <p class="fw-bold fs-3" id="callwaiting">0</p>
                    <h5 class="">Call in waiting</h5>
                  </div>
                  <div class="">
                    <i class="fs-1 active bi bi-bell-fill"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="table-responsive borde rounded mt-4">
                <table class="table mb00" id="dashboardtable">
                  <thead>
                    <tr>
                      <th class="border">Agent Name</th>
                      <th class="border">Campaign Name</th>
                      <th class="border">Status</th>
                      <th class="border">Duration</th>
                      <th class="border">Customer</th>
                      <th class="border">Listen</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- data will be added as per server data -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="row align-items-stretch mb-4">
            <div class="col-sm-5">
              <div class="d-flex h-100">
                <div class="graphbox w-100">
                  <div class="boxx bg-white shadow-sm p-3 rounded-3 h-100">
                    <canvas id="mychart" class="w-100 h-100"></canvas>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-sm-7">
              <div class="">
                <div class="boxx bg-white shadow-sm p-3 rounded-3 w-100 h">
                  <canvas id="earning"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <!-- End #main -->

      <!-- ======= Footer ======= -->
      <footer id="footer" class="footer">
        <div class="copyright">
          &copy; Copyright <strong><span>iotcom</span></strong
          >. All Rights Reserved
        </div>
        <div class="credits">Designed by <a href="https://www.iotcom.io/">Iotcom</a></div>
      </footer>
    </section>

    <!-- End Footer -->

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <script src="jssip-3.10.0.min.js"></script>
    <script>
      // Declare userDetails and queue call data outside the fetch function
      var mainurl = `https://devapp.iotcom.io`;
      let liveuserDetails = [];
      let callinqueue = [];
      const audio = document.querySelector('audio');
      // Get references to the dashboard elements
      const agentlogedin = document.getElementById('agentlogedin');
      const agentincalls = document.getElementById('agentincall');
      const agentonbreak = document.getElementById('breakagent');
      const callwaiting = document.getElementById('callwaiting');
      const storedUsername = document.getElementById('displayUsername');
      const storedUsername1 = document.getElementById('displayUsername1');
      const storedorg = document.getElementById('displayorg');
      var ua;
      var options;
      var session;
      var user;
      let isAudioOnly = false;
      let isFullscreen = false;
      var callended = true; //declaring var for handing end call function
      var playingBridge;
      var campaignDetails = [];

      fetch(`${mainurl}/campaigndetails`, {
        headers: {
          Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
        },
      })
        .then((response) => {
          if (response.status === 401) {
            // Unauthorized response handling: redirect to index page or handle as needed
            window.location.href = '/login.html'; // Replace with your index page URL
          } else if (!response.ok) {
            throw new Error('Network response was not ok');
          } else {
            return response.json();
          }
        })
        .then((data) => {
          campaignDetails = data.result;

          console.log(campaignDetails);
        })
        .catch((error) => {
          console.error('Error fetching user details:', error);
        });

      async function startphone(callData) {
        var socket = new JsSIP.WebSocketInterface('wss://devapp.iotcom.io:8089/ws');

        user = JSON.parse(localStorage.getItem('admininfo')).user;
        let localpass = localStorage.getItem('pass');
        pass = `${localpass}`;
        //console.log(user);
        console.log(pass);

        var configuration = {
          sockets: [socket],
          uri: `sip:${user}@webrtc.iotcom.io`,
          authorization_user: user,
          password: pass,
        };

        ua = await new JsSIP.UA(configuration);

        await ua.start();
        ua.on('registered', async (data) => {
          try {
            const response = await fetch('/listenlivecall', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
              },
              body: JSON.stringify(callData),
            });

            if (!response.ok) {
              throw new Error('Network response was not ok');
            } else {
              console.log('call connected sucessfully');
            }
          } catch (error) {
            console.error('Error connecting live call:', error);
          }
        });
        ua.on('registrationFailed', (data) => {
          console.log(data.response.data);
        });

        ua.on('newRTCSession', (data) => {
          console.log(data);
          callended = false;
          session = data.session;

          //adding eventlisners to listen various event for handling call disconnection
          session.on('ended', (e) => {
            console.log('Call ended');
          });
          session.on('removestream', (e) => {
            console.log('remote stream removed', e);
          });
          session.on('addstream', (e) => {
            console.log('remote stream added', e);
          });

          console.log('Call Direction is ' + session.direction);

          if (session.direction === 'incoming') {
            let localStream; // Declare a variable to hold the local stream
            navigator.mediaDevices.getUserMedia({ audio: true }).then((s) => {
              localStream = s; // Store the local stream in a variable
              //localvideo.srcObject = s;
            });

            session.answer();
            // session.connection.addEventListener("track", function (e){
            //   if (e.streams.length === 0){
            //     console.log("caller disconnected");
            //   }

            // });
            // session.connection.addEventListener('streamEnded', function(data) {
            //   console.log("remote stream ended");
            // });
            // session.connection.onclose=()=>{
            //   console.log("call dead")
            // };

            session.connection.addEventListener('track', function (e) {
              console.log('remote stream added');
              console.log(e);
              const track = e.track;
              console.log('Using audio device: ' + track);
              e.streams[0].oninactive = function () {
                console.log('Stream ended');

                // When the stream becomes inactive, stop the local stream
                if (localStream) {
                  localStream.getTracks().forEach((track) => track.stop());
                }
              };
              if (track.kind === 'audio') {
                audio.srcObject = e.streams[0];
              } else {
                remotevideo.srcObject = e.streams[0];
              }
            });
          } else if (session.direction === 'outgoing') {
            let localStream; // Declare a variable to hold the local stream
            navigator.mediaDevices.getUserMedia({ video: true }).then((s) => {
              localStream = s; // Store the local stream in a variable
              localvideo.srcObject = s;
            });
            console.log(session.connection);
            session.connection.addEventListener('track', function (e) {
              console.log('remote stream added');
              console.log(e);
              const track = e.track;
              console.log('Using audio device: ' + track);

              // When the stream becomes inactive, stop the local stream
              e.streams[0].oninactive = function () {
                if (localStream) {
                  localStream.getTracks().forEach((track) => track.stop());
                }
              };

              audio.srcObject = e.streams[0];
              remotevideo.srcObject = e.streams[0];
            });
          } else {
          }
        });

        // Register callbacks to desired call events
        var eventHandlers = {
          progress: function (e) {
            console.log('call is in progress');
          },
          failed: function (e) {
            console.log('call failed with cause: ' + e.data.cause);
          },
          ended: function (e) {
            console.log('call ended with cause: ' + e.cause);
            console.log(e);
          },
          confirmed: function (e) {
            console.log('call confirmed');
          },

          addstream: function (e) {
            console.log('remote stream added');
          },
        };

        options = {
          eventHandlers: eventHandlers,
          mediaConstraints: { audio: true, video: false },
        };

        //   ua.on("unregistered", (data) => {
        // ua.removeAllListeners();
        // });

        //var session = ua.call('sip:webrtc_client1@webrtc.iotcom.io', options);

        // setTimeout(() => {
        //   ua.call("sip:webrtc_client1@webrtc.iotcom.io", options);
        // }, 5000);
      }

      // Function to fetch and update data
      async function fetchDataAndUpdateDashboard() {
        try {
          const response = await fetch(`${mainurl}/liveuserdetails`, {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
            },
          });

          if (response.status === 401) {
            // Unauthorized response handling: redirect to index page or handle as needed
            window.location.href = '/login.html'; // Replace with your index page URL
            return;
          } else if (!response.ok) {
            throw new Error('Network response was not ok');
          } else {
            const data = await response.json();
            liveuserDetails = data.result;
            callinqueue = data.admincallqueue;
            callsdata = data.adminongoingCalls;
            changedashbarddata(liveuserDetails, callinqueue, callsdata);
          }
        } catch (error) {
          console.error('Error fetching user details:', error);
        }
      }

      // Function to update the dashboard with the data
      function changedashbarddata(liveagentdata, callqueue, callsdata) {
        // Calculate statistics as before
        const liveagents = liveagentdata.filter((a) => a.Status !== 'UNAVAILABLE');
        const incallagent = liveagentdata.filter((a) => a.Status === 'INUSE');
        const breakagent = liveagentdata.filter((a) => a.Status === 'Break');

        const storedUsername = JSON.parse(localStorage.getItem('admininfo')).user;
        const storedorg = JSON.parse(localStorage.getItem('admininfo')).organization;

        if (storedUsername) {
          document.getElementById('displayUsername').innerText = storedUsername;
          document.getElementById('displayUsername1').innerText = storedUsername;
          document.getElementById('displayorg').innerText = storedorg;
        } else {
          document.getElementById('displayUsername').innerText = 'No stored username found.';
          document.getElementById('displayUsernam1').innerText = 'No stored username found.';
        }

        let tabledata = [];
        if (liveagents.length > 0) {
          for (i = 0; i < liveagents.length; i++) {
            liveagents[i].campaign =
              campaignDetails.find((campaign) => campaign.campaignID === liveagents[i].campaign).campaignname || 'NA';
            const rawdata = {
              Agentid: liveagents[i].user,
              campaign: liveagents[i].campaign || 'NO Campaign Assigned',
              Status: liveagents[i].Status,
              Duration: calculateDuration(liveagents[i].Time),
              Customer: callsdata?.find((a) => a.agent === liveagents[i].user)?.Caller,
              Bridge: callsdata?.find((a) => a.agent === liveagents[i].user)?.bridgeID,
            };

            // Function to calculate the duration in a human-readable format
            function calculateDuration(startTime) {
              const currentTime = new Date();
              //console.log("currentTIME", currentTime);
              //console.log("event time", startTime.getTime());

              const timeDifference = currentTime - new Date(startTime);
              const hours = Math.floor(timeDifference / (1000 * 60 * 60));
              const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
              const seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);
              return `${hours}h ${minutes}m ${seconds}s`;
              //return timeDifference
            }

            tabledata.push(rawdata);
          }
        }

        // Update the inner HTML of selected elements
        agentlogedin.innerHTML = liveagents.length;
        agentincalls.innerHTML = incallagent.length;
        agentonbreak.innerHTML = breakagent.length;
        callwaiting.innerHTML = callqueue.length;

        // update table data
        const table = document.getElementById('dashboardtable').getElementsByTagName('tbody')[0];
        table.innerHTML = '';
        user = JSON.parse(localStorage.getItem('admininfo')).user;

        tabledata.forEach(function (call) {
          // Change 'file' to 'call'
          let newRow = table.insertRow(table.rows.length);
          let cell1 = newRow.insertCell(0);
          let cell2 = newRow.insertCell(1);
          let cell3 = newRow.insertCell(2);
          let cell4 = newRow.insertCell(3);
          let cell5 = newRow.insertCell(4);
          let cell6 = newRow.insertCell(5);

          cell1.textContent = call.Agentid;
          cell2.textContent = call.campaign;
          cell3.textContent = call.Status;
          cell4.textContent = call.Duration;
          cell5.textContent = call.Customer;
          let isPlaying = false;
          let playButton = document.createElement('button');
          if (call.Status === 'INUSE') {
            playButton.className = 'btn btn-success play-btn';
            if (playingBridge == call.Bridge) {
              playButton.innerHTML = '<i class="bi bi-pause-fill"></i>';
              cell6.appendChild(playButton);
              isPlaying = true;
            } else {
              playButton.innerHTML = '<i class="bi bi-play-fill"></i>';
              cell6.appendChild(playButton);
              isPlaying = false;
            }
          } else {
            playButton.style.display = 'none';
            //no need to create button
          }
          let bridgecall = call.Bridge;
          const callData = {
            user: user,
            bridge: bridgecall,
          };

          playButton.addEventListener('click', function () {
            if (isPlaying) {
              console.log(` pause button clicked for ${call.Agentid}`);
              playingBridge = null;
              stoplisten({ user: user });
              playButton.innerHTML = '<i class="bi bi-play-fill"></i>';
            } else {
              console.log(` play button clicked for ${call.Agentid}`);
              console.log(`Custmer:${call.Customer}`);
              if (call.Customer) {
                playingBridge = callData.bridge;
                livelisten(callData);
              } else {
                alert('agent not in call');
              }

              playButton.innerHTML = '<i class="bi bi-pause-fill"></i>';
            }
            isPlaying = !isPlaying;
          });

          async function livelisten(callData) {
            console.log(callData);
            startphone(callData);
            console.log('creating request to listen call');
          }
          async function stoplisten(callData) {
            console.log('creating request to listen call');
            try {
              const response = await fetch('/stoplisten', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
                },
                body: JSON.stringify(callData),
              });

              if (!response.ok) {
                throw new Error('Network response was not ok');
              } else {
                console.log('call disconnected sucessfully');
                ua.stop();
              }
            } catch (error) {
              console.error('Error disconnecting live call:', error);
            }
          }
        });
      }

      // Fetch and update data every 5 seconds
      const fetchInterval = 5000; // 5 seconds in milliseconds
      setInterval(fetchDataAndUpdateDashboard, fetchInterval);

      // Initial fetch and update
      fetchDataAndUpdateDashboard();

      // function logout
      function signOut() {
        // Clear localStorage (optional)
        localStorage.removeItem('admininfo');
        localStorage.removeItem('jwtToken');
        localStorage.removeItem('didData');

        // Redirect to the desired location
        window.location.href = '/login.html';
      }
    </script>
    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/tinymce/tinymce.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>
    <script src="my-chart.js"></script>
  </body>
</html>
