<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Call Records</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="./img/favicon.png" rel="icon" />
    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />

    <!-- pagination JQuery -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/buttons/2.1.1/css/buttons.dataTables.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/vfs_fonts.js"></script>

    <!-- Template Main CSS File -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="assets/tailwindcss/globals.css" rel="stylesheet" />
    <script src="assets/tailwindcss/tailwindcss.js"></script>
  </head>

  <body>
    <section class="flex min-h-screen flex-col">
      <header
        id="header"
        class="header sticky top-0 flex items-center bg-white justify-between p-2 shadow-[0_0_07px_0px_rgba(0,0,0,0.2)] z-50"
      >
        <div class="flex justify-between w-full items-center">
          <a href="trunkControl.html">
            <img src="./img/logo.png" alt="iotcom" class="w-48" />
          </a>
          <ul class="flex gap-4 me-5" id="sidebar-nav">
            <li>
              <a class="text-black hover:text-[#2196f3] transition-all" href="admindashboard.html"> Dashboard </a>
            </li>

            <li class="relative">
              <div
                class="cursor-pointer text-black hover:text-[#2196f3] transition-all flex items-center"
                id="usersDropdown"
              >
                Users<i class="bi bi-chevron-down ms-2"></i>
              </div>
              <ul
                class="dropdown-menu overflow-hidden absolute z-50 whitespace-nowrap top-12 bg-white shadow-md transition-all duration-300 ease-in-out transform origin-top-right"
                style="max-height: 0"
              >
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="adduser.html">
                    <i class="bi bi-chevron-right me-2"></i>Add New Users
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="userlist.html">
                    <i class="bi bi-chevron-right me-2"></i>User List
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="AgentLoginHours.html">
                    <i class="bi bi-chevron-right me-2"></i>Agent Login Hours
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="Forcelogout.html">
                    <i class="bi bi-chevron-right me-2"></i>Force Logout
                  </a>
                </li>
              </ul>
            </li>

            <!-- Broadcast Section -->
            <li class="relative">
              <div
                class="cursor-pointer text-black hover:text-[#2196f3] transition-all flex items-center"
                id="broadcastDropdown"
              >
                Broadcast<i class="bi bi-chevron-down ms-2"></i>
              </div>
              <ul
                class="dropdown-menu overflow-hidden absolute z-50 whitespace-nowrap top-12 bg-white shadow-md transition-all duration-300 ease-in-out transform origin-top-right"
                style="max-height: 0"
              >
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="broadcast.html">
                    <i class="bi bi-chevron-right me-2"></i>Add Broadcast
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="Broadcastform.html">
                    <i class="bi bi-chevron-right me-2"></i>Upload Broadcast
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="broadCastReport.html">
                    <i class="bi bi-chevron-right me-2"></i>Broadcast Report
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="broadCastSummary.html">
                    <i class="bi bi-chevron-right me-2"></i>Broadcast Summary
                  </a>
                </li>
              </ul>
            </li>

            <!-- Campaign Section -->
            <li class="relative">
              <div
                class="cursor-pointer text-black hover:text-[#2196f3] transition-all flex items-center"
                id="campaignDropdown"
              >
                Campaign<i class="bi bi-chevron-down ms-2"></i>
              </div>
              <ul
                class="dropdown-menu overflow-hidden absolute z-50 whitespace-nowrap top-12 bg-white shadow-md transition-all duration-300 ease-in-out transform origin-top-right"
                style="max-height: 0"
              >
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="newcampaign.html">
                    <i class="bi bi-chevron-right me-2"></i>Add Campaign
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="form.html">
                    <i class="bi bi-chevron-right me-2"></i>Upload Campaign
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="offlineCampaign.html">
                    <i class="bi bi-chevron-right me-2"></i>Offline Campaign
                  </a>
                </li>
              </ul>
            </li>

            <!-- Menu Section -->
            <li class="relative">
              <a class="text-black hover:text-[#2196f3] transition-all" href="CallMenu.html"> Menu </a>
            </li>

            <!-- Audio Store Section -->
            <li class="relative">
              <a class="text-black hover:text-[#2196f3] transition-all" href="AudioStore.html"> Audio Store </a>
            </li>

            <!-- DID Section -->
            <li class="relative">
              <a class="text-black hover:text-[#2196f3] transition-all" href="DID.html"> DID </a>
            </li>

            <li class="relative">
              <div
                class="cursor-pointer text-[#2196f3] hover:text-[#2196f3] transition-all flex items-center"
                id="callReports"
              >
                Call Reports<i class="bi bi-chevron-down ms-2"></i>
              </div>

              <ul
                class="dropdown-menu overflow-hidden absolute z-50 whitespace-nowrap top-12 bg-white shadow-md transition-all duration-300 ease-in-out transform origin-top-right"
                style="max-height: 0"
              >
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="aprReport.html">
                    <i class="bi bi-chevron-right me-2"></i>Agent performance report
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-[#2196f3] hover:text-[#2196f3] transition-all" href="calldata.html">
                    <i class="bi bi-chevron-right me-2"></i>Call detail report
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="IncomingCallData.html">
                    <i class="bi bi-chevron-right me-2"></i>Incoming Call reports
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="OutgoinfCallData.html">
                    <i class="bi bi-chevron-right me-2"></i>Outgoing Call reports
                  </a>
                </li>
                <li class="p-2">
                  <a class="text-black hover:text-[#2196f3] transition-all" href="incomingDrop.html">
                    <i class="bi bi-chevron-right me-2"></i>Drop Call reports
                  </a>
                </li>
                <!-- Add more items as needed -->
              </ul>
            </li>
          </ul>
        </div>

        <div class="relative inline-block">
          <button class="py-2 px-4 rounded inline-flex items-center focus:outline-none" id="dropdown-btn">
            <img src="img/shiv.jpg" alt="Profile" class="rounded-full w-10 h-10" />
            <span class="d-none d-md-block dropdown-toggle ps-2" id="displayUsername"></span>
            <svg class="fill-current ml-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
              <path
                d="M10 12.586L4.293 6.879a1 1 0 0 0-1.414 1.414l6.364 6.364a1 1 0 0 0 1.414 0l6.364-6.364a1 1 0 0 0-1.414-1.414L10 12.586z"
              />
            </svg>
          </button>
          <div
            class="absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 transition-all duration-200 opacity-0 invisible"
            id="dropdown-menu"
          >
            <ul class="py-1 px-3" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
              <li class="py-3 border-b">
                <h6 id="displayUsername1">Shiv Shekhawat</h6>
                <span id="displayorg">Web Designer</span>
              </li>
              <li class="py-3 border-b">
                <i class="bi bi-person"></i>
                <span>My Profile</span>
              </li>
              <li class="py-3 border-b"><i class="bi bi-gear"></i> <span>Account Settings</span></li>
              <li class="py-3 border-b"><i class="bi bi-question-circle"></i> <span>Need Help?</span></li>
              <li class="py-3">
                <a class="dropdown-item d-flex align-items-center" href="#" onclick="signOut()">
                  <i class="bi bi-box-arrow-right"></i>
                  <span>Sign Out</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </header>

      <main id="main" class="main grow m-2">
        <div class="bg-white shadow-sm p-4">
          <div class="table-container shadow-lg p-3 bg-white">
            <div class="flex justify-between mb-4 items-center">
              <h3 class="text-2xl font-semibold">Call Data</h3>
              <div class="date-range mb-3">
                <input
                  type="text"
                  class="border outline-0 p-2 rounded focus:border-[#2196f3]"
                  id="date-range-picker"
                  placeholder="Select Date Range"
                />
              </div>
            </div>

            <div class="overflow-x-auto whitespace-nowrap">
              <table class="table-auto w-full border-collapse" id="calldata">
                <thead class="thead">
                  <tr>
                    <th>Campaign</th>
                    <th>IVR Menu</th>
                    <th>Customer Number</th>
                    <th>Call Type</th>
                    <th>Agent Name</th>
                    <th>Start Time</th>
                    <th>Answered Time</th>
                    <th>End Time</th>
                    <th>Waiting Queue Time</th>
                    <th>Disposition</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Address</th>
                    <th>City</th>
                    <th>District</th>
                    <th>State</th>
                    <th>PinCode</th>
                    <th>Call Duration</th>
                    <th>Listen</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- call records will be added dynamically -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div
          class="modal fixed inset-0 z-[100] overflow-y-auto top-50 hidden transition-all duration-1000"
          id="musicPlayerModal"
        >
          <div
            class="fixed top-0 flex items-center justify-center left-0 w-full h-full bg-black bg-opacity-50 z-[100]"
            id="modalContainer"
          >
            <div
              class="modal-content bg-white rounded-md shadow-md p-6 transform transition-transform ease-in-out w-1/4"
            >
              <div class="text-2xl cursor-pointer w-max absolute top-0 end-0" id="closeModalButton">
                <i class="bi bi-x"></i>
              </div>

              <div id="wave" class="flex items-center justify-center mb-3">
                <img src="/img/animation-loading.gif" />
              </div>

              <div class="flex items-center justify-center">
                <div class="current-time me-2">00:00</div>
                <input
                  type="range"
                  min="1"
                  max="100"
                  value="0"
                  class="appearance-none h-1 cursor-grab bg-blue-500 seek-slider"
                />
                <div class="total-duration ms-2" id="totalduration">00:00</div>
              </div>

              <div class="flex items-center justify-center">
                <!-- Bootstrap Volume Icons -->
                <i class="bi bi-volume-down me-2"></i>
                <input
                  type="range"
                  min="1"
                  max="100"
                  value="99"
                  class="appearance-none h-1 volume-slider cursor-grab bg-blue-500"
                />
                <i class="bi bi-volume-up ms-2"></i>
              </div>

              <div class="text-center mt-3">
                <a>
                  <i class="bi bi-file-earmark-person"></i>
                  <span id="bridgeID"></span>
                </a>
              </div>

              <div class="buttons flex items-center justify-center opacity-80 gap-10 mt-8">
                <!-- Bootstrap Icons for buttons -->
                <div class="random-track">
                  <i class="text-gray-700 text-4xl bi bi-shuffle"></i>
                </div>
                <div class="prev-track">
                  <i class="text-gray-700 text-4xl bi bi-skip-backward-fill"></i>
                </div>
                <div id="playpause-track101" class="playpause-track">
                  <i class="text-green-500 text-4xl bi bi-play-circle-fill"></i>
                </div>
                <div class="next-track">
                  <i class="text-gray-700 text-4xl bi bi-skip-forward-fill"></i>
                </div>
                <div class="repeat-track">
                  <i class="text-gray-700 text-4xl bi bi-arrow-repeat"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <!-- End #main -->

      <!-- ======= Footer ======= -->
      <footer id="footer" class="footer bg-white text-center p-3 text-md">
        <div class="copyright">
          &copy; Copyright <strong><span>iotcom</span></strong
          >. All Rights Reserved
        </div>
        <div class="credits">Designed by <a href="https://www.iotcom.io/">Iotcom</a></div>
      </footer>
    </section>
    <!-- End Footer -->

    <a
      href="#"
      class="back-to-top invisible flex items-center justify-center bg-[#2196f3] text-white fixed bottom-4 end-4 rounded-full w-10 h-10 hover:bg-white hover:text-[#2196f3] border-[#2196f3] border transition-all"
      ><i class="bi bi-arrow-up-short text-2xl"></i
    ></a>

    <!-- Date Range JS Files -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Include DataTables CSS -->

    <!-- Include DataTables JavaScript -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.1/js/buttons.html5.min.js"></script>

    <script>
      document.getElementById('closeModalButton').addEventListener('click', closeModal);

      function closeModal() {
        const modal = document.getElementById('musicPlayerModal');
        modal.classList.add('hidden');
      }

      var campaignlist;
      var callmenulist;
      let callDetails = []; // Declare userDetails outside the fetch function
      let filteredData = [];
      let ContactData = [];
      let StartDate;
      let EndDate;
      const storedUsername = document.getElementById('displayUsername');
      const storedUsername1 = document.getElementById('displayUsername1');
      const storedorg = document.getElementById('displayorg');

      async function fetchData() {
        try {
          const response = await fetch('https://devapp.iotcom.io/campaigndetails', {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
            },
          });

          // Use await before checking the status and handling the response
          if (response.status === 401) {
            // Unauthorized response handling: redirect to index page or handle as needed
            window.location.href = '/login.html'; // Replace with your index page URL
          } else if (!response.ok) {
            throw new Error('Failed to fetch data');
          } else {
            const data1 = await response.json();
            const data = data1.result;
            campaignlist = data.map((campaign) => ({
              campaignID: campaign.campaignID,
              campaignName: campaign.campaignname,
            }));
          }
        } catch (error) {
          console.error('Error fetching data:', error);
          return {
            campaignlist: [], // Provide a default value in case of an error
          };
        }
      }

      async function fetchData1() {
        try {
          const response = await fetch('https://devapp.iotcom.io/allContacts', {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
            },
          });

          // Use await before checking the status and handling the response
          if (response.status === 401) {
            // Unauthorized response handling: redirect to index page or handle as needed
            window.location.href = '/login.html'; // Replace with your index page URL
          } else if (!response.ok) {
            throw new Error('Failed to fetch data');
          } else {
            const data1 = await response.json();
            const data = data1.result;
            ContactData = data;
          }
        } catch (error) {
          console.error('Error fetching data:', error);
          return {
            ContactData: [], // Provide a default value in case of an error
          };
        }
      }

      async function fetchData2() {
        try {
          const response = await fetch('https://devapp.iotcom.io/callmenuname', {
            headers: {
              Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
            },
          });

          // Use await before checking the status and handling the response
          if (response.status === 401) {
            // Unauthorized response handling: redirect to index page or handle as needed
            window.location.href = '/login.html'; // Replace with your index page URL
          } else if (!response.ok) {
            throw new Error('Failed to fetch data');
          } else {
            const data1 = await response.json();
            const data = data1.result;
            callmenulist = data;
          }
        } catch (error) {
          console.error('Error fetching data:', error);
          return {
            callmenulist: [], // Provide a default value in case of an error
          };
        }
      }
      document.addEventListener('DOMContentLoaded', async function () {
        //console.log("page startted");
        const storedUsername = JSON.parse(localStorage.getItem('admininfo')).user;
        const storedorg = JSON.parse(localStorage.getItem('admininfo')).organization;

        if (storedUsername) {
          document.getElementById('displayUsername').innerText = storedUsername;
          document.getElementById('displayUsername1').innerText = storedUsername;
          document.getElementById('displayorg').innerText = storedorg;
        } else {
          document.getElementById('displayUsername').innerText = 'No stored username found.';
          document.getElementById('displayUsernam1').innerText = 'No stored username found.';
        }
        await fetchData();
        await fetchData1();
        await fetchData2();
        loadcallData();
      });

      // Initialize Flatpickr for date range selection
      flatpickr('#date-range-picker', {
        mode: 'range',
        dateFormat: 'Y-m-d',
        onChange: function (selectedDates, dateStr, instance) {
          StartDate = selectedDates[1];
          EndDate = selectedDates[0];
          if (StartDate !== null && EndDate !== null) {
            loadcallData(StartDate, EndDate);
          } else {
            console.log('select date properly');
          }
        },
      });

      async function loadcallData(StartDate, EndDate) {
        const currentdate = StartDate || new Date();
        var pastTimestamp = new Date().setDate(currentdate.getDate() - 7);
        const pastdate = EndDate || new Date(pastTimestamp);
        const Dateinterval = {
          startdate: new Date(currentdate),
          enddate: new Date(pastdate),
        };
        const formattedDates = {
          startdate: Dateinterval.enddate.toISOString().substring(0, 10),
          enddate: Dateinterval.startdate.toISOString().substring(0, 10),
        };

        console.log(formattedDates);
        filteredData = [];
        fetch('https://devapp.iotcom.io/callData', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
          },
          body: JSON.stringify(formattedDates),
        })
          .then((response) => {
            if (response.status === 401) {
              // Unauthorized response handling: redirect to index page or handle as needed
              window.location.href = '/login.html'; // Replace with your index page URL
            } else if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.json();
          })
          .then((data) => {
            callDetails = data.result;
            console.log(callDetails);
            const uniqueBridgeIDs = new Set();
            if (callDetails !== null) {
              callDetails.forEach((entry) => {
                entry.duration = Math.floor(((entry.hanguptime || entry.calldisconnecttime) - entry.startTime) / 1000);
                entry.waitingqueueTime =
                  entry.Type == 'incoming' ? Math.floor((entry.anstime - entry.startTime) / 1000) : 'NA';
                entry.calldisconnecttime = formatDateTime(entry.hanguptime || entry.calldisconnecttime);
                entry.anstime = formatDateTime(entry.anstime);
                entry.startTime = formatDateTime(entry.startTime);
                entry.campaign = campaignlist.find((a) => a.campaignID === entry.campaign)?.campaignName;
                const foundContact = ContactData.find((contact) => contact.contactNumber === entry.Caller) || 'NA';
                entry.Name = foundContact == 'NA' ? 'NA' : foundContact.firstName + ' ' + foundContact.LastName;
                entry.emailId = foundContact == 'NA' ? 'NA' : foundContact.emailId;
                entry.address = foundContact == 'NA' ? 'NA' : foundContact.Contactaddress;
                entry.city = foundContact == 'NA' ? 'NA' : foundContact.ContactCity;
                entry.district = foundContact == 'NA' ? 'NA' : foundContact.ContactDistrict;
                entry.state = foundContact == 'NA' ? 'NA' : foundContact.ContactState;
                entry.Pincode = foundContact == 'NA' ? 'NA' : foundContact.ContactPincode;
                entry.Callmenu = 'NA';
                if (entry.callProcess) {
                  const callmenuName = callmenulist.find((a) => a.callmenuid == entry.callProcess);
                  entry.Callmenu = callmenuName.callmenuname || 'NA';
                }
                entry.Type = entry.Type == 'incoming' ? 'incoming' : 'outgoing';

                const bridgeID = entry.bridgeID;
                if (!uniqueBridgeIDs.has(bridgeID)) {
                  filteredData.push(entry);
                  uniqueBridgeIDs.add(bridgeID);
                }
              });
              populatecalls(filteredData);
            }
          })
          .catch((error) => {
            console.error('Error fetching call details:', error);
          });
      }

      function populatecalls(filteredData) {
        console.log('populate calls');
        const Dttable = $('#calldata').DataTable();
        Dttable.destroy();
        const table = document.getElementById('calldata').getElementsByTagName('tbody')[0];
        table.innerHTML = '';

        filteredData.forEach(function (call, index) {
          // Change 'file' to 'call'
          let newRow = table.insertRow(table.rows.length);
          // let cell1 = newRow.insertCell(0);
          // let cell2 = newRow.insertCell(1);
          // let cell3 = newRow.insertCell(2);
          // let cell4 = newRow.insertCell(3);
          // let cell5 = newRow.insertCell(4);
          // let cell6 = newRow.insertCell(5);
          // let cell7 = newRow.insertCell(6);
          // let cell8 = newRow.insertCell(7); // Fix the index here

          // cell1.textContent = call.Caller;
          // cell2.textContent = call.dialNumber;
          // cell3.textContent = call.campaign;
          // cell4.textContent = call.startTime;
          // cell5.textContent = call.anstime;
          // cell6.textContent = call.calldisconnecttime;
          // cell7.textContent = call.agent;

          const calldata = [
            call.campaign,
            call.Callmenu,
            call.Caller,
            call.Type,
            call.agent,
            call.startTime,
            call.anstime,
            call.calldisconnecttime,
            call.waitingqueueTime,
            call.Disposition ? call.Disposition : 'No Dispodone',
            call.Name,
            call.emailId,
            call.address,
            call.city,
            call.district,
            call.state,
            call.Pincode,
            call.duration,
          ];
          for (i = 0; i < calldata.length; i++) {
            const cell = newRow.insertCell(i);
            cell.innerHTML = calldata[i] !== undefined ? calldata[i] : 'NA';
          }
          const actioncell1 = newRow.insertCell(calldata.length);

          var playButton = document.createElement('button');
          playButton.className =
            'inline-block rounded text-white bg-green-700 hover:bg-transparent hover:border-green-700 border transition-all	hover:text-green-700 text-lg px-2 py-1';
          playButton.innerHTML = ' <i class="bi bi-headphones"></i>';
          playButton.addEventListener('click', () => playaudio(index));
          actioncell1.appendChild(playButton);
          const audioname = call.bridgeID;

          function playaudio(index) {
            const audioname = filteredData[index]?.bridgeID;
            //Create an Audio element
            const audioElement = new Audio();
            // Set the source of the Audio element if the audio file exists
            const audioSource = '/recording' + audioname + '.wav';
            if (audioSource) {
              audioElement.src = audioSource;
              document.body.appendChild(audioElement);
              const modal = document.getElementById('musicPlayerModal');
              modal.classList.remove('hidden');
            }

            const playpauseBtn = document.getElementById('playpause-track101');
            const seekSlider = document.querySelector('.seek_slider');
            const volumeSlider = document.querySelector('.volume_slider');
            const currentTimeText = document.querySelector('.current-time');
            const totalDurationText = document.querySelector('.total-duration');
            const randomBtn = document.querySelector('.random-track');
            const prevBtn = document.querySelector('.prev-track');
            const nextBtn = document.querySelector('.next-track');
            const repeatBtn = document.querySelector('.repeat-track');
            const wave = document.getElementById('wave');

            const bridgeID = document.getElementById('bridgeID');
            bridgeID.textContent = audioname;

            let currentTrack = 0;
            let isPlaying = false;

            //console.log(duration);

            function playpauseTrack() {
              isPlaying ? pauseTrack() : playTrack();
            }

            function playTrack() {
              console.log(audioElement.duration);
              audioElement.play();
              isPlaying = true;
              wave.classList.add('loader');
              playpauseBtn.innerHTML = '<i class="bi bi-pause-circle-fill text-gray-700 text-4xl"></i>';
            }

            audioElement.onended = function () {
              wave.classList.remove('loader');
              isPlaying = false;
              playpauseBtn.innerHTML = '<i class="bi bi-play-circle-fill text-gray-700 text-4xl"></i>';
            };

            function pauseTrack() {
              audioElement.pause();
              isPlaying = false;
              wave.classList.remove('loader');
              playpauseBtn.innerHTML = '<i class="bi bi-play-circle-fill text-gray-700 text-4xl"></i>';
            }
            playpauseBtn.addEventListener('click', playpauseTrack);

            function updateSeekSlider() {
              const duration = audioElement.duration;
              const currentTime = audioElement.currentTime;
              const displayduration = document.getElementById('totalduration');
              displayduration.innerHTML = formatTime(duration);
              seekSlider.value = (currentTime / duration) * 100;
              currentTimeText.textContent = formatTime(currentTime);
            }

            function setVolume() {
              audioElement.volume = volumeSlider.value / 100;
            }

            function formatTime(time) {
              const minutes = Math.floor(time / 60);
              const seconds = Math.floor(time % 60);
              return `${minutes < 10 ? '0' : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
            }

            // function nextTrack() {
            //     currentTrack = (currentTrack + 1) % playlist.length;
            //     loadAndPlayTrack(currentTrack);
            //     wave.classList.add('loader');
            // }

            // function prevTrack() {
            //     currentTrack = (currentTrack - 1 + playlist.length) % playlist.length;
            //     loadAndPlayTrack(currentTrack);
            //     wave.classList.add('loader');
            // }

            // function randomTrack() {
            //     const randomIndex = Math.floor(Math.random() * playlist.length);
            //     loadAndPlayTrack(randomIndex);
            // }

            function repeatTrack() {
              audioElement.currentTime = 0;
              audioElement.play();
              isPlaying = true;
              wave.classList.add('loader');
              playpauseBtn.innerHTML = '<i class="bi bi-pause-circle-fill text-gray-700 text-4xl"></i>';
            }

            function seekTo() {
              const seekValue = seekSlider.value;
              const duration = audioElement.duration;
              audioElement.currentTime = (seekValue * duration) / 100;
            }

            // function loadAndPlayTrack() {
            //     audioElement.src = audioSource;
            //     audioElement.load();
            //     audioElement.onloadedmetadata = function () {
            //         audioElement.play();
            //         isPlaying = true;
            //         playpauseBtn.innerHTML = '<i class="bi bi-pause-circle-fill"></i>';
            //         totalDurationText.textContent = formatTime(audioElement.duration);
            //     };
            // }

            // nextBtn.addEventListener("click", nextTrack);
            // prevBtn.addEventListener("click", prevTrack);
            // randomBtn.addEventListener("click", randomTrack);
            repeatBtn.addEventListener('click', repeatTrack);
            seekSlider.addEventListener('input', seekTo);
            volumeSlider.addEventListener('input', setVolume);

            audioElement.addEventListener('timeupdate', updateSeekSlider);
            window.addEventListener('click', (event) => {
              if (event.target === modal) {
                audioElement.src = null;
                playpauseBtn.innerHTML = '<i class="bi bi-play-circle-fill"></i>';
                wave.classList.remove('loader');
              }
            });
          }
        });

        $(document).ready(function () {
          $('#calldata').DataTable({
            dom: 'Blfrtip',
            buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
            order: [
              [5, 'desc'], // Column index 5 (zero-based) sorted in descending order
            ],
          });
        });
      }

      function formatDateTime(dateTimeString) {
        const istDate = new Date(dateTimeString);
        const day = String(istDate.getDate()).padStart(2, '0');
        const month = String(istDate.getMonth() + 1).padStart(2, '0');
        const year = istDate.getFullYear();
        const formattedDate = `${day}/${month}/${year}`;

        const formattedTime = istDate.toLocaleString('en-US', {
          timeZone: 'Asia/Kolkata',
          hour: 'numeric',
          minute: 'numeric',
          second: 'numeric',
          hour12: true,
        });

        const istDateFormat = `${formattedDate}\n\n\n${formattedTime}`;
        return istDateFormat;
      }
      function signOut() {
        // Clear localStorage (optional)
        localStorage.removeItem('admininfo');
        localStorage.removeItem('jwtToken');
        localStorage.removeItem('didData');

        // Redirect to the desired location
        window.location.href = '/login.html';
      }
    </script>
    <!-- Vendor JS Files -->
    <script src="assets/vendor/tinymce/tinymce.min.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>
  </body>
</html>
