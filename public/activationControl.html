<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>activation Data</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="./img/favicon.png" rel="icon" />

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />

    <link
      href="https://fonts.googleapis.com/css?family=https://fonts.googleapis.com/css?family=Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet" />
    <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet" />

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body>
    <section class="flex min-h-screen flex-col">
      <header id="header" class="header sticky top-0 flex items-center justify-between">
        <div class="flex justify-between w-full items-center">
          <a href="trunkControl.html">
            <img src="./img/logo.png" alt="iotcom" class="w-56" />
          </a>

          <ul id="sidebar-nav" class="flex gap-10 me-10">
            <li class="">
              <a class="" href="trunkControl.html"> Trunk Control </a>
            </li>
            <li class="">
              <a class="active" href="activationControl.html"> Activation Control </a>
            </li>
            <li class="">
              <a class="" href="autoDialControl.html"> Auto Dial Control </a>
            </li>
            <li class="">
              <a class="" href="broadcastControl.html"> Broad Cast Control </a>
            </li>
            <li class="">
              <a class="" href="didControl.html"> Did Control </a>
            </li>
            <!-- End Dashboard Nav -->
          </ul>
        </div>

        <div class="relative inline-block">
          <button class="py-2 px-4 rounded inline-flex items-center focus:outline-none" id="dropdown-btn">
            <img src="img/shiv.jpg" alt="Profile" class="rounded-full w-10 h-10" />
            <span class="d-none d-md-block dropdown-toggle ps-2" id="displayUsername"></span>
            <svg class="fill-current ml-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
              <path
                d="M10 12.586L4.293 6.879a1 1 0 0 0-1.414 1.414l6.364 6.364a1 1 0 0 0 1.414 0l6.364-6.364a1 1 0 0 0-1.414-1.414L10 12.586z"
              />
            </svg>
          </button>
          <div
            class="absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 transition-all duration-200 opacity-0 invisible"
            id="dropdown-menu"
          >
            <ul class="py-1 px-3" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
              <li class="py-3 border-b">
                <h6 id="displayUsername1">Shiv Shekhawat</h6>
                <span id="displayorg">Web Designer</span>
              </li>
              <li class="py-3 border-b">
                <i class="bi bi-person"></i>
                <span>My Profile</span>
              </li>
              <li class="py-3 border-b"><i class="bi bi-gear"></i> <span>Account Settings</span></li>
              <li class="py-3 border-b"><i class="bi bi-question-circle"></i> <span>Need Help?</span></li>
              <li class="py-3">
                <a class="dropdown-item d-flex align-items-center" href="#" onclick="signOut()">
                  <i class="bi bi-box-arrow-right"></i>
                  <span>Sign Out</span>
                </a>
              </li>
            </ul>
          </div>
        </div>
      </header>

      <main id="main" class="main grow m-8">
        <div class="bg-white shadow-sm p-4">
          <div class="flex justify-between mb-4 items-center">
            <h3 class="text-2xl font-semibold">Activation Deactivation Page</h3>
            <button
              type="button"
              class="cursor-pointer bg-[#2196f3] transition-all text-white p-2 rounded hover:bg-[#fff] hover:border-[#2196f3] border border-[#2196f3] border hover:text-[#2196f3]"
              id="openModalButton"
            >
              Add Admin
            </button>
          </div>
          <table class="table table-bordered w-full" id="dataTable">
            <thead>
              <tr>
                <!-- <th>Campaign ID</th> -->
                <th>Admin User</th>
                <th>Activation</th>
                <th>Edit</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody id="fileTable">
              <!-- Table rows will be dynamically added here -->
            </tbody>
          </table>
        </div>

        <div class="notification" id="successMessage">
          <div class="notification-content">
            <p>data Added Successfully!</p>
          </div>
        </div>

        <div class="notification" id="EditMessage">
          <div class="notification-content">
            <p>data Edited Successfully!</p>
          </div>
        </div>

        <div class="notification" id="DeleteMessage">
          <div class="notification-content">
            <p>data Deleted Successfully!</p>
          </div>
        </div>

        <div
          class="modal fixed inset-0 z-[100] overflow-y-auto top-50 hidden transition-all duration-1000"
          id="myModal"
        >
          <div
            class="fixed top-0 flex items-center justify-center left-0 w-full h-full bg-black bg-opacity-50 z-[100]"
            id="modalContainer"
          >
            <div
              class="modal-content bg-white rounded-md shadow-md p-6 transform transition-transform ease-in-out w-1/4"
            >
              <h5 class="text-2xl text-black mb-3">Add New Admin</h5>
              <div class="text-2xl cursor-pointer w-max absolute top-0 end-0" id="closeModalButton">
                <i class="bx bx-x"></i>
              </div>
              <form id="addForm">
                <div class="mb-4">
                  <label class="block text-sm font-semibold text-gray-600" for="adminuser">Admin User:</label>
                  <input
                    type="text"
                    class="form-input mt-1 block w-full outline-0 focus:border-[#2196f3] rounded-md border px-1 py-2 border-gray-300"
                    id="adminuser"
                    name="adminuser"
                    required
                  />
                </div>
                <div class="mb-4">
                  <label class="block text-sm font-semibold text-gray-600" for="ActivationStatus"
                    >Activation Status:</label
                  >
                  <select
                    class="form-input mt-1 block w-full outline-0 focus:border-[#2196f3] rounded-md border px-1 py-2 border-gray-300"
                    id="Active"
                    name="Active"
                  >
                    <option value="" disabled selected>Select Option</option>
                    <option value="true">true</option>
                    <option value="false">false</option>
                  </select>
                </div>
                <div class="text-center">
                  <button
                    type="button"
                    class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"
                    id="addRowBtn"
                  >
                    Submit
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div
          class="modal fixed inset-0 z-[100] overflow-y-auto top-50 hidden transition-all duration-1000"
          id="editModal"
        >
          <div
            class="fixed top-0 flex items-center justify-center left-0 w-full h-full bg-black bg-opacity-50 z-[100]"
            id="modalEditContainer"
          >
            <div
              class="modal-content bg-white rounded-md shadow-md p-6 transform transition-transform ease-in-out w-1/4"
            >
              <h5 class="text-2xl text-black mb-3">Edit Activation</h5>
              <div class="text-2xl cursor-pointer w-max absolute top-0 end-0" id="closeEditModalButton">
                <i class="bx bx-x"></i>
              </div>
              <form id="editForm">
                <div class="mb-4">
                  <label class="block text-sm font-semibold text-gray-600" for="adminuser1">adminuser:</label>
                  <input
                    type="text"
                    class="form-input mt-1 block w-full outline-0 focus:border-[#2196f3] rounded-md border px-1 py-2 border-gray-300"
                    id="adminuser1"
                    name="adminuser1"
                    disabled
                  />
                </div>
                <div class="mb-4">
                  <label class="block text-sm font-semibold text-gray-600" for="ActivationStatus1">Activation:</label>
                  <select
                    class="form-input mt-1 block w-full outline-0 focus:border-[#2196f3] rounded-md border px-1 py-2 border-gray-300"
                    id="Active1"
                    name="Active1"
                  >
                    <option value="" disabled selected>Select Option</option>
                    <option value="true">true</option>
                    <option value="false">false</option>
                  </select>
                </div>
                <div class="text-center">
                  <button
                    type="button"
                    class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600"
                    <button
                    type="button"
                    class="btn btn-success"
                    id="addRowBtn1"
                  >
                    Submit
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      </main>
      <!-- End #main -->

      <!-- ======= Footer ======= -->
      <footer id="footer" class="footer">
        <div class="copyright">
          &copy; Copyright <strong><span>iotcom</span></strong
          >. All Rights Reserved
        </div>
        <div class="credits">Designed by <a href="https://www.iotcom.io/">Iotcom</a></div>
      </footer>
    </section>

    <!-- End Footer -->

    <a href="#" class="back-to-top flex items-center justify-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>
    <!-- Vendor JS Files -->

    <!-- Template Main JS File -->
   
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        function handleModal(modalId, openButtonId, closeButtonId, modalContainerId) {
          const modal = document.getElementById(modalId);
          const openButton = document.getElementById(openButtonId);
          const closeButton = document.getElementById(closeButtonId);
          const modalContainer = document.getElementById(modalContainerId);

          function openModal() {
            modal.classList.remove('hidden');
          }

          function closeModal() {
            modal.classList.add('hidden');
          }

          openButton.addEventListener('click', openModal);

          closeButton.addEventListener('click', closeModal);

          window.addEventListener('click', function (event) {
            if (event.target === modalContainer) {
              closeModal();
              console.log('Modal closed');
            }
          });
        }

        handleModal('myModal', 'openModalButton', 'closeModalButton', 'modalContainer');
        handleModal('editModal', 'openEditModalButton', 'closeEditModalButton', 'modalEditContainer');
      });

      document.getElementById('addRowBtn').addEventListener('click', async function () {
        // Get input values (including the new call transfer option)
        const adminuser = document.getElementById('adminuser').value;
        const Active = document.getElementById('Active').value;

        // Check if all fields are filled
        if (adminuser && Active) {
          const Data = {
            adminuser: adminuser,
            Active: Active == 'true' ? true : false,
          };
          console.log(Data);

          try {
            const response = await fetch('/activationNewAdmin', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
              },
              body: JSON.stringify(Data),
            });

            if (response) {
              if (response.status === 401) {
                // Unauthorized response handling: redirect to index page or handle as needed
                window.location.href = '/superLogin.html'; // Replace with your index page URL
              } else {
                const result = await response.json();
                console.log(result);
                if (result) {
                  if (result.message === 'duplicate admin user') {
                    alert(result.message);
                    Object.keys(ApiData).forEach((key) => delete ApiData[key]);
                  } else if (result.message === 'database error in saving data to database') {
                    alert(result.message);
                    Object.keys(ApiData).forEach((key) => delete ApiData[key]);
                  } else if (result.message === 'Admin Added successfully') {
                    $('#myModal').modal('hide');
                    var notification = document.getElementById('successMessage');
                    notification.classList.add('show-notification');

                    setTimeout(function () {
                      notification.classList.remove('show-notification');
                      createdom();
                    }, 1000); // Hide the notification after 5 seconds
                  }
                }
              }
            } else {
              alert('failed to add Admin due to server error,try after some time');
            }
          } catch (err) {
            console.error('Error:', err);
            alert('Error in app coding data in creating .');
          }
        } else {
          // If not all fields are filled, display an error message
          alert('Please fill out all fields before adding the data.');
        }
      });

      document.addEventListener('DOMContentLoaded', function () {
        createdom();
      });

      async function createdom() {
        fetch('/activationDetails', {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
          },
        })
          .then((response) => {
            if (response.status === 401) {
              // Unauthorized response handling: redirect to index page or handle as needed
              window.location.href = '/superLogin.html'; // Replace with your index page URL
            } else if (!response.ok) {
              throw new Error('Network response was not ok');
            } else {
              return response.json();
            }
          })
          .then((data) => {
            ApiDetails = data.result;
            console.log(ApiDetails);
            refreshTable(ApiDetails);
          })
          .catch((error) => {
            console.error('Error fetching campaign details:', error);
          });
      }

      function refreshTable(file) {
        const audioFiles = file || [];
        console.log(audioFiles);
        var table = document.getElementById('fileTable');
        table.innerHTML = '';

        audioFiles.forEach(function (file, index) {
          const newRow = table.insertRow(table.rows.length);
          const cell1 = newRow.insertCell(0);
          const cell2 = newRow.insertCell(1);
          const cell3 = newRow.insertCell(2);
          const cell4 = newRow.insertCell(3);

          // cell1.textContent = file.campaignID || file.campaignid;
          cell1.textContent = file.adminuser;
          cell2.textContent = file.Active;

          var editButton = document.createElement('button');
          editButton.className =
            'inline-block rounded text-white bg-green-700 hover:bg-transparent hover:border-green-700 border transition-all	hover:text-green-700 text-lg px-1';
          editButton.innerHTML = '<i class="bi bi-pencil-square"></i>';
          cell3.appendChild(editButton);

          var deleteButton = document.createElement('button');
          deleteButton.className =
            'inline-block rounded text-white bg-red-700 hover:bg-transparent hover:border-red-700 border transition-all	hover:text-red-700 text-lg px-1';
          deleteButton.innerHTML = "<i class='bi bi-trash'></i>";
          cell4.appendChild(deleteButton);

          editButton.addEventListener('click', () => editcallmenu(file, index));
          deleteButton.addEventListener('click', () => deletecallmenu(file, index));
        });
      }

      // Function to delete callmenu from data
      function deletecallmenu(file, index) {
        const confirmation = window.confirm(`Do you really want to deactivate Services of ${file.adminuser} ?`);
        if (confirmation) {
          const campaignID = file.adminuser; // getting callmenu id
          const url = `/activation/${campaignID}`;

          // Make a DELETE request to the server
          fetch(url, {
            method: 'DELETE',
            headers: {
              Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
            },
          })
            .then((response) => {
              if (response.status === 401) {
                // Unauthorized response handling: redirect to index page or handle as needed
                window.location.href = '/superLogin.html'; // Replace with your index page URL
              } else if (!response.ok) {
                throw new Error('Failed to delete ');
              } else {
                return response.json();
              }
            })
            .then((data) => {
              console.log(data.message); // You can do something with the response from the server if needed

              var notification = document.getElementById('DeleteMessage');
              notification.classList.add('show-notification');

              setTimeout(function () {
                notification.classList.remove('show-notification');
                createdom();
              }, 1000);
            })
            .catch((error) => {
              console.error('Error deleting :', error);
            });
        }
      }

      function editcallmenu(file, index) {
        openEditModal(file);
        let adminuser1 = (document.getElementById('adminuser1').value = file.adminuser);
        let Active1 = (document.getElementById('Active1').value = file.Active == true ? 'true' : 'false');

        function handleAddRowBtnClick() {
          const adminuser1 = document.getElementById('adminuser1').value;
          const Active1 = document.getElementById('Active1').value;

          if (adminuser1 && Active1) {
            // first validate

            const newData = {
              adminuser: adminuser1,
              Active: Active1 == 'true' ? true : false,
            };
            console.log(newData);
            const url = `/activation/${adminuser1}`;

            // Make an edit request to the server
            fetch(url, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
              },
              body: JSON.stringify(newData),
            })
              .then((response) => {
                if (response.status === 401) {
                  // Unauthorized response handling: redirect to index page or handle as needed
                  window.location.href = '/superLogin.html'; // Replace with your index page URL
                } else if (!response.ok) {
                  throw new Error('Failed to update Data');
                } else {
                  return response.json();
                }
              })
              .then((data) => {
                console.log(data.message); // You can do something with the response from the server if needed
                modal.classList.remove('hidden');

                var notification = document.getElementById('EditMessage');
                notification.classList.add('show-notification');

                setTimeout(function () {
                  notification.classList.remove('show-notification');
                  createdom();
                }, 1000);
              })
              .catch((error) => {
                console.error('Error Updating:', error);
              });
          } else {
            alert('Enter All Fields');
          }
        }
        document.getElementById('closeEditModalButton').addEventListener('click', closeModal);
        // Add event listener to the "Add Row" button
        document.getElementById('addRowBtn1').addEventListener('click', handleAddRowBtnClick);
      }

      function openEditModal(file) {
        document.getElementById('editModal').classList.remove('hidden');
      }

      function closeModal() {
        document.getElementById('editModal').classList.add('hidden');
      }

      function signOut() {
        // Clear localStorage (optional)
        // localStorage.removeItem('admininfo');
        localStorage.removeItem('jwtToken');
        // localStorage.removeItem('didData');

        // Redirect to the desired location
        window.location.href = '/superLogin.html';
      }

      const dropdownBtn = document.getElementById('dropdown-btn');
      const dropdownMenu = document.getElementById('dropdown-menu');

      dropdownBtn.addEventListener('click', () => {
        dropdownMenu.classList.toggle('opacity-0');
        dropdownMenu.classList.toggle('invisible');
      });

      // Close the dropdown menu when clicking outside
      document.addEventListener('click', (event) => {
        if (!dropdownBtn.contains(event.target) && !dropdownMenu.contains(event.target)) {
          dropdownMenu.classList.add('opacity-0', 'invisible');
        }
      });
    </script>
  </body>
</html>
