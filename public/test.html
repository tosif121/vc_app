<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <p id="reqresponse"></p>
    <script>
//          var messageSocket = new WebSocket('wss://devapp.iotcom.io/socket');
//           // Handle incoming messages from server
//    messageSocket.onmessage = (event) => {
//     const message = JSON.parse(event.data);
    
//     if (message.type === 'ari_message') {
//         console.log('Received ARI message from server:', message.data,new Date());
//         // Perform background tasks to keep browser active
//         messageSocket.send(JSON.stringify({ type: 'message', data: `hello` }));
//     }
// };
async function connectioncheck() {
       
          const user = "dev@shiv";
          try {
            const response = await Promise.race([
              fetch('/userconnection', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({ user: user }),
              }),
              new Promise((_, reject) => {
                // Create a timer that rejects after 3 seconds
                setTimeout(() => {
                  //  console.log("timeout code");
                  reject(new Error('Timeout')); // Timeout after 3 seconds
                }, 3000); // 3 seconds in milliseconds
              }),
            ]);

            if (response.status === 401) {
              // Unauthorized response handling: redirect to index page or handle as needed
              window.location.href = '/index.html'; // Replace with your index page URL
            } else {
              const data = await response.json();
              // console.log("line no 2348",data.message);
              if (data.message === 'ok connection for user') {
                // empty timeout array for short conn. problem
                timeoutarray = [];
              } else if (data.message == 'poor connection problem ,please login again') {
                console.log('connection problem block need to alert');
                alert(data.message);
               // userlogin = false;
                //logoutfunction();
                //window.location.href = `/forcelogout/${user}`;
              } else {
                console.log('other block');
                // Handle other cases as needed
              }
            }
          } catch (err) {
            if (err.message === 'Timeout') {
              
              console.log('Error in connection check function', err);
            }
          }
        
      }

      const liveInterval = 1000; // 1 seconds in milliseconds
      setInterval(connectioncheck, liveInterval);

    </script>
    
</body>
</html>