<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Add/Show DID</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="./img/favicon.png" rel="icon" />

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />

    <!-- <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet"> -->

    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />

    <style>
      body,
      html {
        scroll-behavior: smooth;
        font-family: 'Poppins', sans-serif;
      }

      a {
        text-decoration: none;
      }

      h2 {
        color: #333333;
        text-align: center;
      }

      .btn-success {
        box-shadow: unset !important;
        background-color: #00b865 !important;
        border-color: #00b865 !important;
      }

      .btn-success:hover {
        transition: all 0.4s;
        background-color: transparent !important;
        color: #00b865 !important;
      }

      .container {
        background-color: #ffffff;
        border-radius: 10px;
        box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.1);
      }

      label {
        display: block;
        text-align: left;
        font-size: 16px;
        color: #333333;
        font-weight: bold;
        margin-bottom: 10px;
      }

      .btn-primary {
        background-color: #225d97 !important;
        width: 40%;
        color: #ffffff;
        border: 1px solid transparent;
        border-radius: 8px;
        padding: 12px 12px;
        cursor: pointer;
        font-size: 16px;
        text-transform: uppercase;
      }
      .btn-primary:hover {
        transition: all 0.4s;
        background-color: transparent !important;
        color: #225d97;
        border: 1px solid #225d97;
      }

      .form-control,
      .form-select {
        box-shadow: unset !important;
        padding: 10px !important;
        height: unset;
        width: 100%;
        font-size: 16px;
        margin-bottom: 10px;
        border: 1px solid #aaa;
        border-radius: 6px;
        transition: border-color 0.3s ease-in-out;
      }

      .form-control:focus,
      .form-select:focus {
        border: 1px solid #00498e;
      }

      .table th,
      .table td {
        text-align: center;
      }

      .table thead th {
        background-color: #225d97;
        color: #ffffff;
      }

      .table tbody tr:hover {
        background-color: #f2f2f2;
      }

      .edit-btn,
      .delete-btn {
        border-radius: 5px;
        margin-right: 10px;
      }

      .btn-sm:hover {
        transform: scale(1.1);
      }

      .notification {
        display: none;
        position: fixed;
        background-color: #225d97;
        font-weight: bold;
        color: white;
        padding: 12px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        top: 10%;
        right: 5%;
        max-width: 300px;
        width: 100%;
        text-align: center;
        z-index: 999;
        transition: top 0.3s ease-in-out;
      }

      .show-notification {
        display: block;
        animation: fadeIn 0.5s ease-in-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Responsive CSS */
      @media screen and (max-width: 768px) {
        .notification {
          font-size: 16px;
          padding: 15px;
        }
      }

      @media screen and (max-width: 480px) {
        .notification {
          font-size: 14px;
          padding: 12px;
        }
      }

      .popup {
        display: none;
        position: relative;
        width: 100%;
        height: 100%;
        justify-content: center;
        align-items: center;
      }

      .popup-content {
        background-color: #225d97;
        color: #ffffff;
        padding: 40px;
        border-radius: 10px;
        box-shadow: 0px 0px 20px 0px rgba(0, 0, 0, 0.2);
        max-width: 100%;
        text-align: center;
        overflow-y: auto;
        position: relative;
      }

      .close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        color: #ffffff;
        background-color: #225d97;
        padding: 10px 15px;
        transition: background-color 0.3s ease-in-out;
      }

      .popup1 {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 20px;
        border: 1px solid #ccc;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }

      .close1 {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
      }

      .close:hover {
        background-color: #ffffff;
        color: #333333;
      }

      #addDIDForm {
        grid-template-columns: repeat(2, 1fr);
      }
    </style>
  </head>

  <body>
    <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top d-flex align-items-center">
      

      <div class="d-flex align-items-center justify-content-center" style="padding: 2vw">
        <a href="admindashboard.html" class="logo d-flex align-items-center">
          <img src="./img/logo.png" alt="iotcom" />
        </a>
      </div>
      <!-- End Logo -->

      <div class="search-bar" style="display: none">
        <form class="search-form d-flex align-items-center" method="POST" action="#">
          <input type="text" name="query" placeholder="Search" title="Enter search keyword" />
          <button type="submit" title="Search">
            <i class="bi bi-search"></i>
          </button>
        </form>
      </div>
      <!-- End Search Bar -->

      <nav class="header-nav ms-auto">
        <ul class="d-flex align-items-center">
          <li class="nav-item d-block d-lg-none">
            <a class="nav-link nav-icon search-bar-toggle" href="#" style="display: none">
              <i class="bi bi-search"></i>
            </a>
          </li>
          <!-- End Search Icon-->

          <li class="nav-item dropdown pe-3">
            <a class="nav-link nav-profile d-flex align-items-center pe-0" href="#" data-bs-toggle="dropdown">
              <img src="img/shiv.jpg" alt="Profile" class="rounded-circle" />
              <span class="d-none d-md-block dropdown-toggle ps-2" id="displayUsername"></span> </a
            ><!-- End Profile Iamge Icon -->

            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
              <li class="dropdown-header">
                <h6 id="displayUsername1">Shiv Shekhawat</h6>
                <span id="displayorg">Web Designer</span>
              </li>
              <li>
                <hr class="dropdown-divider" />
              </li>

              <li>
                <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                  <i class="bi bi-person"></i>
                  <span>My Profile</span>
                </a>
              </li>
              <li>
                <hr class="dropdown-divider" />
              </li>

              <li>
                <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                  <i class="bi bi-gear"></i>
                  <span>Account Settings</span>
                </a>
              </li>
              <li>
                <hr class="dropdown-divider" />
              </li>

              <li>
                <a class="dropdown-item d-flex align-items-center" href="pages-faq.html">
                  <i class="bi bi-question-circle"></i>
                  <span>Need Help?</span>
                </a>
              </li>
              <li>
                <hr class="dropdown-divider" />
              </li>

              <li>
                <a class="dropdown-item d-flex align-items-center" href="#" onclick="signOut()">
                  <i class="bi bi-box-arrow-right"></i>
                  <span>Sign Out</span>
                </a>
              </li>
            </ul>
            <!-- End Profile Dropdown Items -->
          </li>
          <!-- End Profile Nav -->
        </ul>
      </nav>
      <!-- End Icons Navigation -->
    </header>
    <!-- End Header -->

    <!-- ======= Sidebar ======= -->
    <aside id="sidebar" class="sidebar">
      <ul class="sidebar-nav" id="sidebar-nav">
        <li class="nav-item">
          <a class="nav-link" href="admindashboard.html">
            <i class="bi bi-grid"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <!-- End Dashboard Nav -->

        <li class="nav-item">
          <a class="nav-link collapsed" data-bs-target="#icons-nav" data-bs-toggle="collapse" href="#">
            <i class="bi bi-gem"></i><span>Users</span><i class="bi bi-chevron-down ms-auto"></i>
          </a>
          <ul id="icons-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
            <li>
              <a href="adduser.html"> <i class="bi bi-circle"></i><span>Add New Users</span> </a>
            </li>
            <li>
              <a href="userlist.html"> <i class="bi bi-circle"></i><span>User List</span> </a>
            </li>
            <li>
              <a href="AgentLoginHours.html"> <i class="bi bi-circle"></i><span>Agent Login Hours</span> </a>
            </li>

            <li>
              <a href="Forcelogout.html"> <i class="bi bi-circle"></i><span>Force Logout</span> </a>
            </li>
          </ul>
        </li>

        <!-- Broadcast Section -->
        <li class="nav-item">
          <a class="nav-link collapsed" data-bs-target="#Broadcast-nav" data-bs-toggle="collapse" href="#">
            <i class="bi bi-broadcast"></i><span>Broadcast</span><i class="bi bi-chevron-down ms-auto"></i>
          </a>
          <ul id="Broadcast-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
            <li>
              <a href="broadcast.html"> <i class="bi bi-circle"></i><span>Add Broadcast</span> </a>
            </li>
            <li>
              <a href="Broadcastform.html"> <i class="bi bi-circle"></i><span>Upload Broadcast</span> </a>
            </li>
            <li>
              <a href="broadCastReport.html"> <i class="bi bi-circle"></i><span>Broadcast Report</span> </a>
            </li>
            <li>
              <a href="broadCastSummary.html"> <i class="bi bi-circle"></i><span>Broadcast Summary</span> </a>
            </li>
            <!-- Add more items as needed -->
          </ul>
        </li>

        <!-- campagian Section -->
        <li class="nav-item">
          <a class="nav-link collapsed" data-bs-target="#Campaign-nav" data-bs-toggle="collapse" href="#">
            <i class="bi bi-layout-text-window-reverse"></i><span>Campaign</span
            ><i class="bi bi-chevron-down ms-auto"></i>
          </a>
          <ul id="Campaign-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
            <li>
              <a href="newcampaign.html"> <i class="bi bi-circle"></i><span>Add Campaign</span> </a>
            </li>

            <li>
              <a href="form.html"> <i class="bi bi-circle"></i><span>Upload Campaign</span> </a>
            </li>
            <!-- Add more items as needed -->
          </ul>
        </li>
        <!-- End Blank Page Nav -->

        <li class="nav-item">
          <a class="nav-link collapsed" href="CallMenu.html">
            <i class="bi bi-telephone-plus"></i>
            <span>Call Menu</span>
          </a>
        </li>
        <!-- End Blank Page Nav -->

        <li class="nav-item">
          <a class="nav-link collapsed" href="AudioStore.html">
            <i class="bi bi-file-earmark-music"></i>
            <span>Audio Store</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" href="DID.html">
            <i class="bi bi-card-list"></i>
            <span>Add/Show DID</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" data-bs-target="#Data-nav" data-bs-toggle="collapse" href="#">
            <i class="bi bi-database-check"></i><span>Call Data</span><i class="bi bi-chevron-down ms-auto"></i>
          </a>
          <ul id="Data-nav" class="nav-content collapse" data-bs-parent="#sidebar-nav">
            <li>
              <a href="IncomingCallData.html"> <i class="bi bi-circle"></i><span>Incoming Call Data</span> </a>
            </li>

            <li>
              <a href="OutgoinfCallData.html"> <i class="bi bi-circle"></i><span>Outgoing Call Data</span> </a>
            </li>
            <!-- Add more items as needed -->
          </ul>
        </li>
      </ul>
    </aside>
    <!-- End Sidebar-->

    <main id="main" class="main">
      <div class="container">
        <div class="table-responsive p-3">
          <h3>DID Data</h3>
          <!-- Button to trigger modal -->
          <table class="table table-bordered" id="dataTable">
            <button type="button" class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#myModal">
              DID
            </button>
            <thead>
              <tr>
                <th>DID Name</th>
                <th>DID Number</th>
                <th>Welcome Music</th>
                <th>Music option</th>
                <th>Transfer</th>
                <th>Transfer ID</th>
                <th>Edit</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody id="fileTable">
              <!-- Table rows will be dynamically added here -->
            </tbody>
          </table>

          <div class="notification" id="successMessage">
            <div class="notification-content">
              <p>DID Added Successfully!</p>
            </div>
          </div>

          <div class="notification" id="EditMessage">
            <div class="notification-content">
              <p>DID Edit Successfully!</p>
            </div>
          </div>

          <div class="notification" id="DeleteMessage">
            <div class="notification-content">
              <p>DID Delete Successfully!</p>
            </div>
          </div>
        </div>
      </div>
      <!-- Modal for adding new DID -->
      <div
        class="modal fade modal-lg"
        id="myModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Add New DID</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <!-- Form to add new DID -->
              <form id="addDIDForm" class="d-grid gap-3">
                <div class="mb-3">
                  <label for="didId" class="form-label">DID Name</label>
                  <input type="text" class="form-control" id="didId" name="didId" />
                </div>
                <div class="mb-3">
                  <label for="didNumber" class="form-label">DID Number</label>
                  <!-- <input type="text" class="form-control" id="didNumber" name="didNumber" /> -->
                  <select class="form-select" id="didNumber" name="didNumber">
                    <!-- Add more options if needed -->
                  </select>
                </div>
                <div class="mb-3">
                  <label for="didmusicoption" class="form-label">Welcome Music</label>
                  <select class="form-select" id="didmusicoption" name="didmusicoption">
                    <option value="No">No</option>
                    <option value="yes">Yes</option>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="welcomeMusic" class="form-label">Welcome Music Option</label>
                  <select class="form-select" id="welcomeMusic" name="welcomeMusic">
                    <option value="No">No</option>
                    <!-- Add more options if needed -->
                  </select>
                </div>
                <div class="mb-3">
                  <label for="transferOption" class="form-label">Transfer Option</label>
                  <select class="form-select" id="transferOption" name="transferOption">
                    <option value="" disabled selected>Select Option</option>
                    <option value="callmenu">Call Menu</option>
                    <option value="campaign">Campaign</option>
                    <option value="hangup">Hangup</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="transferID" class="form-label">Transfer ID</label>
                  <select class="form-select" id="transferID" name="transferID">
                    <!--Option will be created based on transfer option-->
                  </select>
                </div>
                <button type="submit" class="btn btn-primary">Add DID</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal for edting  DID -->
      <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel1">Edit DID</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <!-- Form to add new DID -->
              <form id="editDIDForm">
                <div class="mb-3">
                  <label for="didId1" class="form-label">DID Name</label>
                  <input type="text" class="form-control" id="didId1" name="didId1" disabled />
                </div>
                <div class="mb-3">
                  <label for="didNumber1" class="form-label">DID Number</label>
                  <!-- <input type="text" class="form-control" id="didNumber1" name="didNumber1" /> -->
                  <select class="form-select" id="didNumber1" name="didNumber1">
                    <!-- Add more options if needed -->
                  </select>
                </div>

                <div class="mb-3">
                  <label for="didmusicoption1" class="form-label">Welcome Music</label>
                  <select class="form-select" id="didmusicoption1" name="didmusicoption1">
                    <option value="No">No</option>
                    <option value="yes">Yes</option>
                  </select>
                </div>

                <div class="mb-3">
                  <label for="welcomeMusic1" class="form-label">Welcome Music</label>
                  <select class="form-select" id="welcomeMusic1" name="welcomeMusic1">
                    <option value="No">No</option>
                    <!-- Add more options if needed -->
                  </select>
                </div>
                <div class="mb-3">
                  <label for="transferOption1" class="form-label">Transfer Option</label>
                  <select class="form-select" id="transferOption1" name="transferOption1">
                    <option value="" disabled selected>Select Option</option>
                    <option value="callmenu">callmenu</option>
                    <option value="campaign">campaign</option>
                    <option value="hangup">hangup</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="transferID1" class="form-label">Transfer ID</label>
                  <select class="form-select" id="transferID1" name="transferID1">
                    <!--Option will be created based on transfer option-->
                  </select>
                </div>
                <button type="submit" id="editDIDbtn" class="btn btn-success">Save DID</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <script>
        let campaignDetails;
        let callmenuDetails;
        var DIDdetails;
        var Numbers;

        const storedUsername = JSON.parse(localStorage.getItem('admininfo')).user;
        const storedorg = JSON.parse(localStorage.getItem('admininfo')).organization;

        if (storedUsername) {
          document.getElementById('displayUsername').innerText = storedUsername;
          document.getElementById('displayUsername1').innerText = storedUsername;
          document.getElementById('displayorg').innerText = storedorg;
        } else {
          document.getElementById('displayUsername').innerText = 'No stored username found.';
          document.getElementById('displayUsernam1').innerText = 'No stored username found.';
        }

        fetch('/callmenuname', {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
          },
        })
          .then((response) => {
            if (response.status === 401) {
              // Unauthorized response handling: redirect to index page or handle as needed
              window.location.href = '/login.html'; // Replace with your index page URL
            } else if (!response.ok) {
              throw new Error('Network response was not ok');
            } else {
              return response.json();
            }
          })
          .then((data) => {
            callmenuDetails = data.result;
            console.log(callmenuDetails);
          })
          .catch((error) => {
            console.error('Error fetching user details:', error);
          });

        fetch('/campaigndetails', {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
          },
        })
          .then((response) => {
            if (response.status === 401) {
              // Unauthorized response handling: redirect to index page or handle as needed
              window.location.href = '/login.html'; // Replace with your index page URL
            } else if (!response.ok) {
              throw new Error('Network response was not ok');
            } else {
              return response.json();
            }
          })
          .then((data) => {
            campaignDetails = data.result;

            console.log(campaignDetails);
          })
          .catch((error) => {
            console.error('Error fetching user details:', error);
          });

        document.addEventListener('DOMContentLoaded', async function () {
          createdom()
            .then(() => {
              console.log(Numbers);
              optioncreate(Numbers, 'didNumber1');
              optioncreate(Numbers, 'didNumber');
            })
            .catch((error) => {
              console.error('Error:', error);
            });
        });

        async function createdom() {
          try {
            const response = await fetch('/DIDdata', {
              headers: {
                Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
              },
            });

            if (response.status === 401) {
              window.location.href = '/login.html'; // Unauthorized response handling: redirect to index page or handle as needed
            } else if (!response.ok) {
              throw new Error('Network response was not ok');
            }

            const data = await response.json();
            DIDdetails = data.result;
            Numbers = data.number;

            console.log(DIDdetails);
            refreshTable(DIDdetails);
          } catch (error) {
            console.error('Error fetching campaign details:', error);
          }
        }

        function refreshTable(file) {
          let audioFiles = file || [];
          console.log(audioFiles);
          var table = document.getElementById('fileTable');
          table.innerHTML = '';

          audioFiles.forEach(function (file, index) {
            if (file.transfertype === 'campaign') {
              file.transferID = campaignDetails.find(
                (campaign) => campaign.campaignID === file.transferID
              ).campaignname;
            } else if (file.transfertype === 'callmenu') {
              file.transferID = callmenuDetails.find((a) => a.callmenuid === file.transferID).callmenuname;
            }

            const newRow = table.insertRow(table.rows.length);
            const cell1 = newRow.insertCell(0);
            const cell2 = newRow.insertCell(1);
            const cell3 = newRow.insertCell(2);
            const cell4 = newRow.insertCell(3);
            const cell5 = newRow.insertCell(4);
            const cell6 = newRow.insertCell(5);
            const cell7 = newRow.insertCell(6);
            const cell8 = newRow.insertCell(7);

            cell1.textContent = file.DIDid.split('.')[0];
            cell2.textContent = file.DIDnumber;
            cell3.textContent = file.welcomesound;
            cell4.textContent = file.sound;
            cell5.textContent = file.transfertype;
            cell6.textContent = file.transferID;
            var editButton = document.createElement('button');
            editButton.className = 'btn btn-success ';
            editButton.innerHTML = '<i class="bi bi-pencil-square"></i>';
            cell7.appendChild(editButton);

            var deleteButton = document.createElement('button');
            deleteButton.className = 'btn btn-danger';
            deleteButton.innerHTML = "<i class='bi bi-trash'></i>";
            cell8.appendChild(deleteButton);

            editButton.addEventListener('click', () => editDID(file, index));
            deleteButton.addEventListener('click', () => deleteDID(file, index));
          });
        }

        // Function to delete DIDindex from data
        function deleteDID(file, index) {
          const confirmation = window.confirm('Do you really want to delete Current DID ?');
          if (confirmation) {
            const DIDid = file.DIDid; // getting did id
            console.log(DIDid);
            const url = `/DID/${DIDid}`;

            // Make a DELETE request to the server
            fetch(url, {
              method: 'DELETE',
              headers: {
                Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
              },
            })
              .then((response) => {
                if (response.status === 401) {
                  // Unauthorized response handling: redirect to index page or handle as needed
                  window.location.href = '/login.html'; // Replace with your index page URL
                } else if (!response.ok) {
                  throw new Error('Failed to delete DID');
                } else {
                  return response.json();
                }
                s;
              })
              .then((data) => {
                console.log(data.message); // You can do something with the response from the server if needed

                var notification = document.getElementById('DeleteMessage');
                notification.classList.add('show-notification');

                setTimeout(function () {
                  notification.classList.remove('show-notification');
                  createdom();
                }, 1000);
              })
              .catch((error) => {
                console.error('Error deleting DID:', error);
              });
          }
        }

        function editDID(file, index) {
          $('#editModal').modal('show');
          // set the default values
          const newDIDid = (document.getElementById('didId1').value = file.DIDid);
          document.getElementById('didNumber1').value = file.DIDnumber;
          document.getElementById('welcomeMusic1').value = file.sound;
          document.getElementById('didmusicoption1').value = file.welcomesound;

          document.getElementById('transferOption1').value = file.transfertype;
          document.getElementById('transferID1').value = file.transferID;

          function handleAddRowBtnClick() {
            const newName1 = document.getElementById('didNumber1').value;
            const newDescription1 = document.getElementById('welcomeMusic1').value;
            const newActive1 = document.getElementById('transferOption1').value;
            const newmusic1 = document.getElementById('didmusicoption1').value;

            const newParkMusic1 = document.getElementById('transferID1').value;

            const newData = {
              DIDid: newDIDid,
              DIDnumber: newName1,
              welcomesound: newmusic1,
              sound: newDescription1,
              transfertype: newActive1,
              transferID: newParkMusic1,
            };
            console.log(newData);
            if (newData.transfertype === 'campaign') {
              newData.transferID = parseInt(newData.transferID, 10);
            }
            const url = `/DID/${newDIDid}`;

            // Make a edit request to the server
            fetch(url, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
              },
              body: JSON.stringify(newData),
            })
              .then((response) => {
                if (response.status === 401) {
                  // Unauthorized response handling: redirect to index page or handle as needed
                  window.location.href = '/login.html'; // Replace with your index page URL
                } else if (!response.ok) {
                  throw new Error('Failed to update DID');
                } else {
                  return response.json();
                }
              })
              .then((data) => {
                console.log(data.message); // You can do something with the response from the server if needed
                $('#editModal').modal('hide');

                var notification = document.getElementById('EditMessage');
                notification.classList.add('show-notification');

                setTimeout(function () {
                  notification.classList.remove('show-notification');
                  createdom();
                }, 1000);
              })
              .catch((error) => {
                console.error('Error Updating DID:', error);
              });
          }
          document.getElementById('editDIDbtn').addEventListener('click', handleAddRowBtnClick);
          // Remove event listener when the modal is hidden
          $('#editModal').on('hidden.bs.modal', function () {
            document.getElementById('editDIDbtn').removeEventListener('click', handleAddRowBtnClick);
          });
        }

        // var filePopup = document.getElementById("filePopup");
        // var closePopupButton = document.getElementById("closePopup");
        // event listner to transfer option in edit menu
        document.getElementById('transferOption1').addEventListener('change', async function () {
          console.log('Transfer Option 1 is changed.');
          const selectedTransferOption1 = await this.value;
          if (selectedTransferOption1 === 'callmenu') {
            optioncreate(callmenuDetails, 'transferID1');
          } else if (selectedTransferOption1 === 'campaign') {
            optioncreate(campaignDetails, 'transferID1');
          } else {
            // create option for hangup
            optioncreate([{ name: 'hangup' }], 'transferID1');
          }
        });

        // Add an event listener to the "Transfer Option" select field
        document.getElementById('transferOption').addEventListener('change', async function () {
          console.log('Transfer Option changed.');

          //console.log(newActive);
          const selectedTransferOption = await this.value; // Get the selected Transfer Option
          console.log(selectedTransferOption);
          if (selectedTransferOption === 'callmenu') {
            optioncreate(callmenuDetails, 'transferID');
          } else if (selectedTransferOption === 'campaign') {
            optioncreate(campaignDetails, 'transferID');
          } else {
            // Clear and disable the "Transfer ID" select field
            optioncreate([{ name: 'hangup' }], 'transferID');
          }
        });

        // Function to clear and disable a select field
        function clearSelect(selectId) {
          const selectField = document.getElementById(selectId);
          selectField.innerHTML = ''; // Clear the options
          selectField.disabled = true; // Disable the select field
        }

        document.getElementById('addDIDForm').addEventListener('submit', async function (event) {
          event.preventDefault();

          // Get input values
          const newId = document.getElementById('didId').value;
          const newName = document.getElementById('didNumber').value;
          const newDescription = document.getElementById('welcomeMusic').value;
          const newmusicoption = document.getElementById('didmusicoption').value;
          const newActive = await document.getElementById('transferOption').value;
          const newParkMusic = document.getElementById('transferID').value;

          if (newId && newName && newActive && newmusicoption && newDescription && newParkMusic) {
            // Check if all fields are filled
            const DIDData = {
              DIDid: newId,
              DIDnumber: newName,
              welcomesound: newmusicoption,
              sound: newDescription,
              transfertype: newActive,
              transferID: newParkMusic,
            };
            //console.log(DIDData);
            if (DIDData.transfertype === 'campaign') {
              DIDData.transferID = parseInt(DIDData.transferID, 10);
            }
            try {
              const response = await fetch('/createDID', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
                },
                body: JSON.stringify(DIDData),
              });
              if (response.status === 401) {
                // Unauthorized response handling: redirect to index page or handle as needed
                window.location.href = '/login.html'; // Replace with your index page URL
              } else {
                const result = await response.json();
                if (result.message === 'DID created successfully') {
                  $('#myModal').modal('hide');
                  var notification = document.getElementById('successMessage');
                  notification.classList.add('show-notification');

                  setTimeout(function () {
                    notification.classList.remove('show-notification');
                    createdom();
                  }, 1000);
                } else {
                  alert(result.message);
                }
              }
            } catch (err) {
              console.error('Error:', err);
              alert('Error in app coding data in creating campaign.');
            }
          } else {
            // If not all fields are filled, display an error message
            alert('Please fill out all fields before adding the DID.');
          }
        });

        fetch('/sounddetails', {
          headers: {
            Authorization: `Bearer ${localStorage.getItem('jwtToken')}`,
          },
        })
          .then((response) => {
            if (response.status === 401) {
              // Unauthorized response handling: redirect to index page or handle as needed
              window.location.href = '/login.html'; // Replace with your index page URL
            } else if (!response.ok) {
              throw new Error('Network response was not ok');
            } else {
              return response.json();
            }
          })
          .then((data) => {
            soundDetails = data.result;
            console.log(soundDetails);
            optioncreate(soundDetails, 'welcomeMusic');
            optioncreate(soundDetails, 'welcomeMusic1');
          })
          .catch((error) => {
            console.error('Error fetching user details:', error);
          });

        function optioncreate(Array, HtmlID) {
          const Data = Array || [];
          const optionSelect = document.getElementById(HtmlID);

          // Clear previous options by removing all child nodes
          while (optionSelect.firstChild) {
            optionSelect.removeChild(optionSelect.firstChild);
          }

          Data.forEach((obj) => {
            const option = document.createElement('option');
            option.className = 'form-select'; // Use "className" instead of "class"
            option.value = obj.name || obj.callmenuid || obj.campaignID || obj.number;
            option.text = obj.name || obj.callmenuname || obj.campaignname || obj.number;
            optionSelect.appendChild(option);
          });
        }

        function signOut() {
          // Clear localStorage (optional)
          localStorage.removeItem('admininfo');
          localStorage.removeItem('jwtToken');
          localStorage.removeItem('didData');

          // Redirect to the desired location
          window.location.href = '/login.html';
        }
      </script>
    </main>
    <!-- End #main -->

    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
      <div class="copyright">
        &copy; Copyright <strong><span>iotcom</span></strong
        >. All Rights Reserved
      </div>
      <div class="credits">Designed by <a href="https://www.iotcom.io/">Iotcom</a></div>
    </footer>
    <!-- End Footer -->

    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/tinymce/tinymce.min.js"></script>
    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </body>
</html>
